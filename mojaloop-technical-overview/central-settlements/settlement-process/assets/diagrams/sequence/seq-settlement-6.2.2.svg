<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="2606px" preserveAspectRatio="none" style="width:1192px;height:2606px;" version="1.1" viewBox="0 0 1192 2606" width="1192px" zoomAndPan="magnify"><defs><filter height="300%" id="fnsnkoigg7zu6" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="477" x="358" y="23.5352">6.2.2. Query Settlements by Parameters (getSettlementsByParams)</text><rect fill="#FFB6C1" height="2560.6582" style="stroke: #A80036; stroke-width: 1.0;" width="112" x="118" y="34.4883"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="81" x="133.5" y="47.0566">Central HUB</text><rect fill="#90EE90" height="2560.6582" style="stroke: #A80036; stroke-width: 1.0;" width="411.5" x="352.5" y="34.4883"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="124" x="496.25" y="47.0566">Settlement Service</text><rect fill="#FFFFE0" height="2560.6582" style="stroke: #A80036; stroke-width: 1.0;" width="114" x="840" y="34.4883"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="108" x="843" y="47.0566">Central Services</text><rect fill="#FFFFFF" filter="url(#fnsnkoigg7zu6)" height="2329.3711" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="169" y="147.2871"/><rect fill="#FFFFFF" filter="url(#fnsnkoigg7zu6)" height="2106.6445" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="430" y="370.0137"/><rect fill="#FFFFFF" filter="url(#fnsnkoigg7zu6)" height="641.8008" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="698" y="414.6348"/><rect fill="#FFFFFF" filter="url(#fnsnkoigg7zu6)" height="583.1797" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="892" y="443.9453"/><rect fill="#FFFFFF" filter="url(#fnsnkoigg7zu6)" height="2337.3711" style="stroke: #000000; stroke-width: 2.0;" width="1167" x="13" y="154.2871"/><rect fill="#FFFFFF" filter="url(#fnsnkoigg7zu6)" height="1413.2227" style="stroke: #000000; stroke-width: 2.0;" width="942" x="23" y="1071.4355"/><rect fill="#FFFFFF" filter="url(#fnsnkoigg7zu6)" height="515.9375" style="stroke: #000000; stroke-width: 2.0;" width="520" x="435" y="1165.6777"/><rect fill="#FFFFFF" height="186.4844" style="stroke: none; stroke-width: 1.0;" width="942" x="23" y="2298.1738"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="174" x2="174" y1="137.2871" y2="2508.6582"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="434.5" x2="434.5" y1="137.2871" y2="2508.6582"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="703" x2="703" y1="137.2871" y2="2508.6582"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="897" x2="897" y1="137.2871" y2="2508.6582"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="98" x="122" y="134.334">Hub Employee</text><ellipse cx="174" cy="63.7988" fill="#FEFECE" filter="url(#fnsnkoigg7zu6)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M174,71.7988 L174,98.7988 M161,79.7988 L187,79.7988 M174,98.7988 L161,113.7988 M174,98.7988 L187,113.7988 " fill="none" filter="url(#fnsnkoigg7zu6)" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="98" x="122" y="2521.1934">Hub Employee</text><ellipse cx="174" cy="2534.1465" fill="#FEFECE" filter="url(#fnsnkoigg7zu6)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M174,2542.1465 L174,2569.1465 M161,2550.1465 L187,2550.1465 M174,2569.1465 L161,2584.1465 M174,2569.1465 L187,2584.1465 " fill="none" filter="url(#fnsnkoigg7zu6)" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="151" x="356.5" y="134.334">Settlement Service API</text><path d="M414.5,92.7988 L414.5,116.7988 M414.5,104.7988 L431.5,104.7988 " fill="none" filter="url(#fnsnkoigg7zu6)" style="stroke: #A80036; stroke-width: 2.0;"/><ellipse cx="443.5" cy="104.7988" fill="#FEFECE" filter="url(#fnsnkoigg7zu6)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="151" x="356.5" y="2521.1934">Settlement Service API</text><path d="M414.5,2528.1465 L414.5,2552.1465 M414.5,2540.1465 L431.5,2540.1465 " fill="none" filter="url(#fnsnkoigg7zu6)" style="stroke: #A80036; stroke-width: 2.0;"/><ellipse cx="443.5" cy="2540.1465" fill="#FEFECE" filter="url(#fnsnkoigg7zu6)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="108" x="646" y="134.334">Settlement DAO</text><ellipse cx="703" cy="104.7988" fill="#FEFECE" filter="url(#fnsnkoigg7zu6)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="691" x2="715" y1="118.7988" y2="118.7988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="108" x="646" y="2521.1934">Settlement DAO</text><ellipse cx="703" cy="2540.1465" fill="#FEFECE" filter="url(#fnsnkoigg7zu6)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="691" x2="715" y1="2554.1465" y2="2554.1465"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="90" x="849" y="134.334">Central Store</text><path d="M879,84.7988 C879,74.7988 897,74.7988 897,74.7988 C897,74.7988 915,74.7988 915,84.7988 L915,110.7988 C915,120.7988 897,120.7988 897,120.7988 C897,120.7988 879,120.7988 879,110.7988 L879,84.7988 " fill="#FEFECE" filter="url(#fnsnkoigg7zu6)" style="stroke: #000000; stroke-width: 1.5;"/><path d="M879,84.7988 C879,94.7988 897,94.7988 897,94.7988 C897,94.7988 915,94.7988 915,84.7988 " fill="none" style="stroke: #000000; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="90" x="849" y="2521.1934">Central Store</text><path d="M879,2534.1465 C879,2524.1465 897,2524.1465 897,2524.1465 C897,2524.1465 915,2524.1465 915,2534.1465 L915,2560.1465 C915,2570.1465 897,2570.1465 897,2570.1465 C897,2570.1465 879,2570.1465 879,2560.1465 L879,2534.1465 " fill="#FEFECE" filter="url(#fnsnkoigg7zu6)" style="stroke: #000000; stroke-width: 1.5;"/><path d="M879,2534.1465 C879,2544.1465 897,2544.1465 897,2544.1465 C897,2544.1465 915,2544.1465 915,2534.1465 " fill="none" style="stroke: #000000; stroke-width: 1.5;"/><rect fill="#FFFFFF" filter="url(#fnsnkoigg7zu6)" height="2329.3711" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="169" y="147.2871"/><rect fill="#FFFFFF" filter="url(#fnsnkoigg7zu6)" height="2106.6445" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="430" y="370.0137"/><rect fill="#FFFFFF" filter="url(#fnsnkoigg7zu6)" height="641.8008" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="698" y="414.6348"/><rect fill="#FFFFFF" filter="url(#fnsnkoigg7zu6)" height="583.1797" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="892" y="443.9453"/><path d="M13,154.2871 L285,154.2871 L285,161.2871 L275,171.2871 L13,171.2871 L13,154.2871 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="2337.3711" style="stroke: #000000; stroke-width: 2.0;" width="1167" x="13" y="154.2871"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="227" x="28" y="167.8555">Query Settlements by Parameters</text><path d="M184,176.5977 L184,339.5977 L652,339.5977 L652,186.5977 L642,176.5977 L184,176.5977 " fill="#FFFF00" filter="url(#fnsnkoigg7zu6)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M642,176.5977 L642,186.5977 L652,186.5977 L642,176.5977 " fill="#FFFF00" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="53" x="190" y="194.166">Params:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="172" x="190" y="209.4766">?[state={settlementStateId}]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="215" x="190" y="224.7871">[&amp;fromDateTime={fromDateTime}]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="181" x="190" y="240.0977">[&amp;toDateTime={toDateTime}]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="155" x="190" y="255.4082">[&amp;currency={currencyId}]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="291" x="190" y="270.7188">[&amp;settlementWindowId={settlementWindowId}]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="447" x="190" y="286.0293">[&amp;fromSettlementWindowDateTime={fromSettlementWindowDateTime}]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="413" x="190" y="301.3398">[&amp;toSettlementWindowDateTime={toSettlementWindowDateTime}]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="195" x="190" y="316.6504">[&amp;participantId={participantId}]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="233" x="190" y="331.9609">[&amp;accountId={participantCurrencyId}]</text><polygon fill="#A80036" points="418,366.0137,428,370.0137,418,374.0137,422,370.0137" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="179" x2="424" y1="370.0137" y2="370.0137"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="186" y="365.2715">1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="121" x="199" y="365.2715">GET - /settlements</text><polygon fill="#A80036" points="686,410.6348,696,414.6348,686,418.6348,690,414.6348" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="440" x2="692" y1="414.6348" y2="414.6348"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="447" y="402.2373">2</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="128" x="460" y="394.582">Retrieve settlements</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="73" x="460" y="409.8926">Error code:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="537" y="409.8926">2001</text><polygon fill="#A80036" points="880,439.9453,890,443.9453,880,447.9453,884,443.9453" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="708" x2="886" y1="443.9453" y2="443.9453"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="715" y="439.2031">3</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="147" x="728" y="439.2031">Retrieve requested data</text><polygon fill="#FFFFE0" filter="url(#fnsnkoigg7zu6)" points="633,456.9453,1160,456.9453,1170,727.9453,1160,999.9453,633,999.9453,623,727.9453,633,456.9453" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="45" x="635" y="473.5137">SELECT</text><text fill="#0000AA" font-family="sans-serif" font-size="13" font-style="italic" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="62" x="684" y="473.5137">DISTINCT</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="237" x="750" y="473.5137">s.settlementId, ssc.settlementStateId,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="443" x="663" y="488.8242">ssw.settlementWindowId, swsc.settlementWindowStateId, swsc.reason</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="473" x="663" y="504.1348">settlementWindowReason, sw.createdDate, swsc.createdDate changedDate,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="359" x="663" y="519.4453">pc.participantId, spc.participantCurrencyId, spcsc.reason</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="442" x="663" y="534.7559">accountReason, spcsc.settlementStateId accountState, spc.netAmount</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="303" x="663" y="550.0664">accountAmount, pc.currencyId accountCurrency</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="36" x="635" y="565.377">FROM</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="72" x="675" y="565.377">settlement</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="7" x="751" y="565.377">s</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="28" x="635" y="580.6875">JOIN</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="157" x="667" y="580.6875">settlementStateChange</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="21" x="828" y="580.6875">ssc</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="370" x="635" y="595.998">ON ssc.settlementStateChangeId = s.currentStateChangeId</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="28" x="635" y="611.3086">JOIN</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="197" x="667" y="611.3086">settlementSettlementWindow</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="24" x="868" y="611.3086">ssw</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="239" x="635" y="626.6191">ON ssw.settlementId = s.settlementId</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="28" x="635" y="641.9297">JOIN</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="125" x="667" y="641.9297">settlementWindow</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="17" x="796" y="641.9297">sw</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="347" x="635" y="657.2402">ON sw.settlementWindowId = ssw.settlementWindowId</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="28" x="635" y="672.5508">JOIN</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="210" x="667" y="672.5508">settlementWindowStateChange</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="31" x="881" y="672.5508">swsc</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="439" x="635" y="687.8613">ON swsc.settlementWindowStateChangeId = sw.currentStateChangeId</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="28" x="635" y="703.1719">JOIN</text><text fill="#0000AA" font-family="sans-serif" font-size="13" font-style="italic" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="178" x="667" y="703.1719">settlementWindowContent</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="24" x="849" y="703.1719">swc</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="347" x="635" y="718.4824">ON swc.settlementWindowId = sw.settlementWindowId</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="28" x="635" y="733.793">JOIN</text><text fill="#0000AA" font-family="sans-serif" font-size="13" font-style="italic" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="263" x="667" y="733.793">settlementWindowContentAggregation</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="31" x="934" y="733.793">swca</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="461" x="635" y="749.1035">ON swca.settlementWindowContentId = swc.settlementWindowContentId</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="28" x="635" y="764.4141">JOIN</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="207" x="667" y="764.4141">settlementParticipantCurrency</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="22" x="878" y="764.4141">spc</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="237" x="635" y="779.7246">ON spc.settlementId = s.settlementId</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="384" x="635" y="795.0352">AND spc.participantCurrencyId = swca.participantCurrencyId</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="28" x="635" y="810.3457">JOIN</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="292" x="667" y="810.3457">settlementParticipantCurrencyStateChange</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="36" x="963" y="810.3457">spcsc</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="523" x="635" y="825.6563">ON spcsc.settlementParticipantCurrencyStateChangeId = spc.currentStateChangeId</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="28" x="635" y="840.9668">JOIN</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="136" x="667" y="840.9668">participantCurrency</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="15" x="807" y="840.9668">pc</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="359" x="635" y="856.2773">ON pc.participantCurrencyId = spc.participantCurrencyId</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="326" x="635" y="871.5879">WHERE [ssc.settlementStateId = {settlementStateId}]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="253" x="635" y="886.8984">[AND s.createdDate &gt;= {fromDateTime}]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="236" x="635" y="902.209">[AND s.createdDate &lt;= {toDateTime}]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="218" x="635" y="917.5195">[AND pc.currencyId = {currencyId}]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="200" x="635" y="932.8301">[AND sw.settlementWindowId =</text><text fill="#0000AA" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="136" x="839" y="932.8301">{settlementWindowId}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="975" y="932.8301">]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="379" x="635" y="948.1406">[AND sw.createdDate &gt;= {fromSettlementWindowDateTime}]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="362" x="635" y="963.4512">[AND sw.createdDate &lt;= {toSettlementWindowDateTime}]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="246" x="635" y="978.7617">[AND pc.participantId = {participantId}]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="365" x="635" y="994.0723">[AND spc.participantCurrencyId = {participantCurrencyId}]</text><polygon fill="#A80036" points="719,1023.125,709,1027.125,719,1031.125,715,1027.125" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="713" x2="896" y1="1027.125" y2="1027.125"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="725" y="1022.3828">4</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="72" x="738" y="1022.3828">Return data</text><polygon fill="#A80036" points="451,1052.4355,441,1056.4355,451,1060.4355,447,1056.4355" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="445" x2="702" y1="1056.4355" y2="1056.4355"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="457" y="1051.6934">5</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="41" x="470" y="1051.6934">Return</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="110" x="515" y="1051.6934">settlementsData</text><path d="M23,1071.4355 L85,1071.4355 L85,1078.4355 L75,1088.4355 L23,1088.4355 L23,1071.4355 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="1413.2227" style="stroke: #000000; stroke-width: 2.0;" width="942" x="23" y="1071.4355"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="17" x="38" y="1085.0039">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="117" x="100" y="1084.0703">[Settlement(s) found]</text><path d="M445,1093.7461 L445,1148.7461 L586,1148.7461 L586,1103.7461 L576,1093.7461 L445,1093.7461 " fill="#D3D3D3" filter="url(#fnsnkoigg7zu6)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M576,1093.7461 L576,1103.7461 L586,1103.7461 L576,1093.7461 " fill="#D3D3D3" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="120" x="451" y="1111.3145">let settlements = {}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="87" x="451" y="1126.625">let settlement</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="88" x="451" y="1141.9355">let participant</text><path d="M435,1165.6777 L509,1165.6777 L509,1172.6777 L499,1182.6777 L435,1182.6777 L435,1165.6777 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="515.9375" style="stroke: #000000; stroke-width: 2.0;" width="520" x="435" y="1165.6777"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="29" x="450" y="1179.2461">loop</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="97" x="524" y="1178.3125">[settlementsData]</text><path d="M445,1187.9883 L445,1671.9883 L941,1671.9883 L941,1197.9883 L931,1187.9883 L445,1187.9883 " fill="#D3D3D3" filter="url(#fnsnkoigg7zu6)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M931,1187.9883 L931,1197.9883 L941,1197.9883 L931,1187.9883 " fill="#D3D3D3" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="301" x="451" y="1205.5566">if (!settlements[settlementsData.settlementId]) {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="290" x="467" y="1220.8672">settlements[settlementsData.settlementId] = {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="215" x="483" y="1236.1777">"id: settlementsData.settlementId,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="266" x="483" y="1251.4883">"state": settlementsData.settlementStateId</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="467" y="1266.7988">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="451" y="1282.1094">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="353" x="451" y="1297.4199">settlement = settlements[settlementsData.settlementId]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="470" x="451" y="1312.7305">if (!settlement.settlementWindows[settlementsData.settlementWindowId]) {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="459" x="467" y="1328.041">settlement.settlementWindows[settlementsData.settlementWindowId] = {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="269" x="483" y="1343.3516">"id": settlementsData.settlementWindowId,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="319" x="483" y="1358.6621">"state": settlementsData.settlementWindowStateId,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="332" x="483" y="1373.9727">"reason": settlementsData.settlementWindowReason,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="279" x="483" y="1389.2832">"createdDate": settlementsData.createdDate,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="289" x="483" y="1404.5938">"changedDate": settlementsData.changedDate</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="467" y="1419.9043">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="451" y="1435.2148">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="374" x="451" y="1450.5254">if (!settlement.participants[settlementsData.participantId]) {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="363" x="467" y="1465.8359">settlement.participants[settlementsData.participantId] = {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="217" x="483" y="1481.1465">"id": settlementsData.participantId</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="467" y="1496.457">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="451" y="1511.7676">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="427" x="451" y="1527.0781">participant = settlement.participants[settlementsData.participantId]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="328" x="451" y="1542.3887">participant.accounts[settlementsData.accountId] = {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="277" x="467" y="1557.6992">"id": settlementsData.participantCurrencyId,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="241" x="467" y="1573.0098">"state": settlementsData.accountState,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="266" x="467" y="1588.3203">"reason": settlementsData.accountReason,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="159" x="467" y="1603.6309">"netSettlementAmount": {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="277" x="483" y="1618.9414">"amount": settlementsData.accountAmount,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="285" x="483" y="1634.252">"currency": settlementsData.accountCurrency</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="467" y="1649.5625">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="451" y="1664.873">}</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="440" x2="482" y1="1714.9258" y2="1714.9258"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="482" x2="482" y1="1714.9258" y2="1727.9258"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="435" x2="482" y1="1727.9258" y2="1727.9258"/><polygon fill="#A80036" points="445,1723.9258,435,1727.9258,445,1731.9258,441,1727.9258" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="447" y="1710.1836">6</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="65" x="460" y="1710.1836">Transform</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="79" x="529" y="1710.1836">settlements</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="79" x="612" y="1710.1836">map to array</text><path d="M33,1735.9258 L33,1760.9258 L421,1760.9258 L421,1745.9258 L411,1735.9258 L33,1735.9258 " fill="#D3D3D3" filter="url(#fnsnkoigg7zu6)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M411,1735.9258 L411,1745.9258 L421,1745.9258 L411,1735.9258 " fill="#D3D3D3" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="367" x="39" y="1753.4941">Are we going to report window content related info below?</text><path d="M110,1775.2363 L110,2259.2363 L421,2259.2363 L421,1785.2363 L411,1775.2363 L110,1775.2363 " fill="#FFFF00" filter="url(#fnsnkoigg7zu6)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M411,1775.2363 L411,1785.2363 L421,1785.2363 L411,1775.2363 " fill="#FFFF00" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="116" y="1792.8047">[</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="132" y="1808.1152">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="113" x="148" y="1823.4258">"id": settlementId,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="163" x="148" y="1838.7363">"state": settlementStateId,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="145" x="148" y="1854.0469">"settlementWindows": [</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="164" y="1869.3574">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="162" x="180" y="1884.668">"id": settlementWindowId,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="212" x="180" y="1899.9785">"state": settlementWindowStateId,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="225" x="180" y="1915.2891">"reason": settlementWindowReason,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="172" x="180" y="1930.5996">"createdDate": createdDate,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="182" x="180" y="1945.9102">"changedDate": changedDate</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="164" y="1961.2207">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="148" y="1976.5313">],</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="97" x="148" y="1991.8418">"participants": [</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="164" y="2007.1523">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="114" x="180" y="2022.4629">"id": participantId,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="79" x="180" y="2037.7734">"accounts": [</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="196" y="2053.084">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="170" x="212" y="2068.3945">"id": participantCurrencyId,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="134" x="212" y="2083.7051">"state": accountState,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="159" x="212" y="2099.0156">"reason": accountReason,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="159" x="212" y="2114.3262">"netSettlementAmount": {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="170" x="228" y="2129.6367">"amount": accountAmount,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="178" x="228" y="2144.9473">"currency": accountCurrency</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="212" y="2160.2578">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="196" y="2175.5684">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="180" y="2190.8789">]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="164" y="2206.1895">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="148" y="2221.5">]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="132" y="2236.8105">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="116" y="2252.1211">]</text><polygon fill="#A80036" points="190,2286.1738,180,2290.1738,190,2294.1738,186,2290.1738" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="184" x2="429" y1="2290.1738" y2="2290.1738"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="196" y="2285.4316">7</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="161" x="209" y="2285.4316">Respond HTTP - 200 (OK)</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="23" x2="965" y1="2299.1738" y2="2299.1738"/><path d="M445,2305.1738 L445,2330.1738 L572,2330.1738 L572,2315.1738 L562,2305.1738 L445,2305.1738 " fill="#D3D3D3" filter="url(#fnsnkoigg7zu6)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M562,2305.1738 L562,2315.1738 L572,2315.1738 L562,2305.1738 " fill="#D3D3D3" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="106" x="451" y="2322.7422">Log ERROR event</text><path d="M91,2344.4844 L91,2445.4844 L421,2445.4844 L421,2354.4844 L411,2344.4844 L91,2344.4844 " fill="#FFFF00" filter="url(#fnsnkoigg7zu6)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M411,2344.4844 L411,2354.4844 L421,2354.4844 L411,2344.4844 " fill="#FFFF00" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="97" y="2362.0527">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="116" x="113" y="2377.3633">errorInformation: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="148" x="129" y="2392.6738">"errorCode": &lt;integer&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="277" x="129" y="2407.9844">"errorDescription": "Client error description"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="113" y="2423.2949">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="97" y="2438.6055">}</text><polygon fill="#A80036" points="185,2472.6582,175,2476.6582,185,2480.6582,181,2476.6582" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="179" x2="434" y1="2476.6582" y2="2476.6582"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="191" y="2471.916">8</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="214" x="204" y="2471.916">Respond HTTP - 4xx (Client error)</text><!--
@startuml
title 6.2.2. Query Settlements by Parameters (getSettlementsByParams)

autonumber

actor "Hub Employee" as OPERATOR
boundary "Settlement Service API" as SSAPI
entity "Settlement DAO" as SETTLE_DAO
database "Central Store" as DB

box "Central HUB" #LightPink
    participant OPERATOR
end box

box "Settlement Service" #LightGreen
    participant SSAPI
    participant SETTLE_DAO
end box

box "Central Services" #LightYellow
    participant DB
end box

group Query Settlements by Parameters
    activate OPERATOR
    note right of OPERATOR #Yellow
        **Params:**
        ?[state={settlementStateId}]
        [&fromDateTime={fromDateTime}]
        [&toDateTime={toDateTime}]
        [&currency={currencyId}]
        [&settlementWindowId={settlementWindowId}]
        [&fromSettlementWindowDateTime={fromSettlementWindowDateTime}]
        [&toSettlementWindowDateTime={toSettlementWindowDateTime}]
        [&participantId={participantId}]
        [&accountId={participantCurrencyId}]
    end note

    OPERATOR -> SSAPI: GET - /settlements
    activate SSAPI
    SSAPI -> SETTLE_DAO: Retrieve settlements\n<color #FF0000><b>Error code:</b> 2001</color>
    activate SETTLE_DAO

    SETTLE_DAO -> DB: Retrieve requested data
    activate DB
    hnote over DB #lightyellow
        SELECT <color 00A>**//DISTINCT//**</color> s.settlementId, ssc.settlementStateId,
               ssw.settlementWindowId, swsc.settlementWindowStateId, swsc.reason 
               settlementWindowReason, sw.createdDate, swsc.createdDate changedDate, 
               pc.participantId, spc.participantCurrencyId, spcsc.reason
               accountReason, spcsc.settlementStateId accountState, spc.netAmount
               accountAmount, pc.currencyId accountCurrency
        FROM **settlement** s
        JOIN **settlementStateChange** ssc
        ON ssc.settlementStateChangeId = s.currentStateChangeId
        JOIN **settlementSettlementWindow** ssw
        ON ssw.settlementId = s.settlementId
        JOIN **settlementWindow** sw
        ON sw.settlementWindowId = ssw.settlementWindowId
        JOIN **settlementWindowStateChange** swsc
        ON swsc.settlementWindowStateChangeId = sw.currentStateChangeId
        JOIN <color 00A>**//settlementWindowContent//**</color> swc
        ON swc.settlementWindowId = sw.settlementWindowId
        JOIN <color 00A>**//settlementWindowContentAggregation//**</color> swca
        ON swca.settlementWindowContentId = swc.settlementWindowContentId
        JOIN **settlementParticipantCurrency** spc
        ON spc.settlementId = s.settlementId
        AND spc.participantCurrencyId = swca.participantCurrencyId
        JOIN **settlementParticipantCurrencyStateChange** spcsc
        ON spcsc.settlementParticipantCurrencyStateChangeId = spc.currentStateChangeId
        JOIN **participantCurrency** pc
        ON pc.participantCurrencyId = spc.participantCurrencyId
        WHERE [ssc.settlementStateId = {settlementStateId}]
        [AND s.createdDate >= {fromDateTime}]
        [AND s.createdDate <= {toDateTime}]
        [AND pc.currencyId = {currencyId}]
        [AND sw.settlementWindowId = <color 00A>//{settlementWindowId}//</color>]
        [AND sw.createdDate >= {fromSettlementWindowDateTime}]
        [AND sw.createdDate <= {toSettlementWindowDateTime}]
        [AND pc.participantId = {participantId}]
        [AND spc.participantCurrencyId = {participantCurrencyId}]
    end hnote
    SETTLE_DAO <- - DB: Return data
    deactivate DB
    SSAPI <- - SETTLE_DAO: Return **settlementsData**
    deactivate SETTLE_DAO
    alt Settlement(s) found
        note right of SSAPI #lightgray
            let settlements = {}
            let settlement
            let participant
        end note
        loop settlementsData
            note right of SSAPI #lightgray
                if (!settlements[settlementsData.settlementId]) {
                    settlements[settlementsData.settlementId] = {
                        "id: settlementsData.settlementId,
                        "state": settlementsData.settlementStateId
                    }
                }
                settlement = settlements[settlementsData.settlementId]
                if (!settlement.settlementWindows[settlementsData.settlementWindowId]) {
                    settlement.settlementWindows[settlementsData.settlementWindowId] = {
                        "id": settlementsData.settlementWindowId,
                        "state": settlementsData.settlementWindowStateId,
                        "reason": settlementsData.settlementWindowReason,
                        "createdDate": settlementsData.createdDate,
                        "changedDate": settlementsData.changedDate
                    }
                }
                if (!settlement.participants[settlementsData.participantId]) {
                    settlement.participants[settlementsData.participantId] = {
                        "id": settlementsData.participantId
                    }
                }
                participant = settlement.participants[settlementsData.participantId]
                participant.accounts[settlementsData.accountId] = {
                    "id": settlementsData.participantCurrencyId,
                    "state": settlementsData.accountState,
                    "reason": settlementsData.accountReason,
                    "netSettlementAmount": {
                        "amount": settlementsData.accountAmount,
                        "currency": settlementsData.accountCurrency
                    }
                }
            end note
        end
        SSAPI -> SSAPI: Transform **settlements** map to array
        deactivate SETTLE_DAO
        note left of SSAPI #lightgray
            <color #red>Are we going to report window content related info below?</color>
        end note
        note left of SSAPI #yellow
            [
                {
                    "id": settlementId,
                    "state": settlementStateId,
                    "settlementWindows": [
                        {
                            "id": settlementWindowId,
                            "state": settlementWindowStateId,
                            "reason": settlementWindowReason,
                            "createdDate": createdDate,
                            "changedDate": changedDate
                        }
                    ],
                    "participants": [
                        {
                            "id": participantId,
                            "accounts": [
                                {
                                    "id": participantCurrencyId,
                                    "state": accountState,
                                    "reason": accountReason,
                                    "netSettlementAmount": {
                                        "amount": accountAmount,
                                        "currency": accountCurrency
                                    }
                                }
                            ]
                        }
                    ]
                }
            ]
        end note
        OPERATOR <- - SSAPI: Respond HTTP - 200 (OK)
    else
        note right of SSAPI #lightgray
            Log ERROR event
        end note
        note left of SSAPI #yellow
            {
                errorInformation: {
                    "errorCode": <integer>,
                    "errorDescription": "Client error description"
                }
            }
        end note
        OPERATOR <- - SSAPI: Respond HTTP - 4xx (Client error)
        deactivate SSAPI
        deactivate OPERATOR
    end
end
@enduml

PlantUML version 1.2018.05(Sat May 05 23:00:17 EEST 2018)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Java Version: 1.8.0_131-b11
Operating System: Mac OS X
OS Version: 10.15.1
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>