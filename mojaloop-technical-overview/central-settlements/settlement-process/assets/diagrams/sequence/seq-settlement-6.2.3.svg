<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="3641px" preserveAspectRatio="none" style="width:1257px;height:3641px;" version="1.1" viewBox="0 0 1257 3641" width="1257px" zoomAndPan="magnify"><defs><filter height="300%" id="fzx7e7hkbe4ou" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="778" x="240.5" y="23.5352">6.2.3. Get Settlement By Settlement, Participant and Account (getSettlementBySettlementParticipantAccount)</text><rect fill="#FFB6C1" height="3595.9297" style="stroke: #A80036; stroke-width: 1.0;" width="112" x="109" y="34.4883"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="81" x="124.5" y="47.0566">Central HUB</text><rect fill="#90EE90" height="3595.9297" style="stroke: #A80036; stroke-width: 1.0;" width="479.5" x="352.5" y="34.4883"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="124" x="530.25" y="47.0566">Settlement Service</text><rect fill="#FFFFE0" height="3595.9297" style="stroke: #A80036; stroke-width: 1.0;" width="114" x="882" y="34.4883"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="108" x="885" y="47.0566">Central Services</text><rect fill="#FFFFFF" filter="url(#fzx7e7hkbe4ou)" height="3364.6426" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="160" y="147.2871"/><rect fill="#FFFFFF" filter="url(#fzx7e7hkbe4ou)" height="3364.6426" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="430" y="147.2871"/><rect fill="#FFFFFF" filter="url(#fzx7e7hkbe4ou)" height="183.1738" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="766" y="446.6348"/><rect fill="#FFFFFF" filter="url(#fzx7e7hkbe4ou)" height="198.4844" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="766" y="768.6719"/><rect fill="#FFFFFF" filter="url(#fzx7e7hkbe4ou)" height="167.8633" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="766" y="1106.0195"/><rect fill="#FFFFFF" filter="url(#fzx7e7hkbe4ou)" height="167.8633" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="766" y="1412.7461"/><rect fill="#FFFFFF" filter="url(#fzx7e7hkbe4ou)" height="587.248" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="766" y="1740.4727"/><rect fill="#FFFFFF" filter="url(#fzx7e7hkbe4ou)" height="372.9004" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="766" y="2372.3418"/><rect fill="#FFFFFF" filter="url(#fzx7e7hkbe4ou)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="934" y="475.9453"/><rect fill="#FFFFFF" filter="url(#fzx7e7hkbe4ou)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="934" y="797.9824"/><rect fill="#FFFFFF" filter="url(#fzx7e7hkbe4ou)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="934" y="1135.3301"/><rect fill="#FFFFFF" filter="url(#fzx7e7hkbe4ou)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="934" y="1442.0566"/><rect fill="#FFFFFF" filter="url(#fzx7e7hkbe4ou)" height="536.627" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="934" y="1769.7832"/><rect fill="#FFFFFF" filter="url(#fzx7e7hkbe4ou)" height="322.2793" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="934" y="2401.6523"/><rect fill="#FFFFFF" filter="url(#fzx7e7hkbe4ou)" height="3372.6426" style="stroke: #000000; stroke-width: 2.0;" width="1233" x="13" y="154.2871"/><rect fill="#FFFFFF" filter="url(#fzx7e7hkbe4ou)" height="123.8633" style="stroke: #000000; stroke-width: 2.0;" width="420.5" x="103" y="178.5977"/><rect fill="#FFFFFF" height="61.9316" style="stroke: none; stroke-width: 1.0;" width="420.5" x="103" y="240.5293"/><rect fill="#FFFFFF" filter="url(#fzx7e7hkbe4ou)" height="957.8008" style="stroke: #000000; stroke-width: 2.0;" width="813.5" x="326.5" y="714.7402"/><rect fill="#FFFFFF" filter="url(#fzx7e7hkbe4ou)" height="613.4531" style="stroke: #000000; stroke-width: 2.0;" width="772.5" x="336.5" y="1052.0879"/><rect fill="#FFFFFF" filter="url(#fzx7e7hkbe4ou)" height="299.7266" style="stroke: #000000; stroke-width: 2.0;" width="752.5" x="346.5" y="1358.8145"/><rect fill="#FFFFFF" filter="url(#fzx7e7hkbe4ou)" height="1833.3887" style="stroke: #000000; stroke-width: 2.0;" width="1213" x="23" y="1686.541"/><rect fill="#FFFFFF" filter="url(#fzx7e7hkbe4ou)" height="514.627" style="stroke: #000000; stroke-width: 2.0;" width="514" x="682" y="1784.7832"/><rect fill="#FFFFFF" height="280.2793" style="stroke: none; stroke-width: 1.0;" width="514" x="682" y="2019.1309"/><rect fill="#FFFFFF" filter="url(#fzx7e7hkbe4ou)" height="300.2793" style="stroke: #000000; stroke-width: 2.0;" width="574" x="652" y="2416.6523"/><rect fill="#FFFFFF" height="142.4844" style="stroke: none; stroke-width: 1.0;" width="574" x="652" y="2574.4473"/><rect fill="#FFFFFF" height="199.4395" style="stroke: none; stroke-width: 1.0;" width="1213" x="23" y="3320.4902"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="165" x2="165" y1="137.2871" y2="3543.9297"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="434.5" x2="434.5" y1="137.2871" y2="3543.9297"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="771" x2="771" y1="137.2871" y2="3543.9297"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="939" x2="939" y1="137.2871" y2="3543.9297"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="98" x="113" y="134.334">Hub Employee</text><ellipse cx="165" cy="63.7988" fill="#FEFECE" filter="url(#fzx7e7hkbe4ou)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M165,71.7988 L165,98.7988 M152,79.7988 L178,79.7988 M165,98.7988 L152,113.7988 M165,98.7988 L178,113.7988 " fill="none" filter="url(#fzx7e7hkbe4ou)" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="98" x="113" y="3556.4648">Hub Employee</text><ellipse cx="165" cy="3569.418" fill="#FEFECE" filter="url(#fzx7e7hkbe4ou)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M165,3577.418 L165,3604.418 M152,3585.418 L178,3585.418 M165,3604.418 L152,3619.418 M165,3604.418 L178,3619.418 " fill="none" filter="url(#fzx7e7hkbe4ou)" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="151" x="356.5" y="134.334">Settlement Service API</text><path d="M414.5,92.7988 L414.5,116.7988 M414.5,104.7988 L431.5,104.7988 " fill="none" filter="url(#fzx7e7hkbe4ou)" style="stroke: #A80036; stroke-width: 2.0;"/><ellipse cx="443.5" cy="104.7988" fill="#FEFECE" filter="url(#fzx7e7hkbe4ou)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="151" x="356.5" y="3556.4648">Settlement Service API</text><path d="M414.5,3563.418 L414.5,3587.418 M414.5,3575.418 L431.5,3575.418 " fill="none" filter="url(#fzx7e7hkbe4ou)" style="stroke: #A80036; stroke-width: 2.0;"/><ellipse cx="443.5" cy="3575.418" fill="#FEFECE" filter="url(#fzx7e7hkbe4ou)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="108" x="714" y="134.334">Settlement DAO</text><ellipse cx="771" cy="104.7988" fill="#FEFECE" filter="url(#fzx7e7hkbe4ou)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="759" x2="783" y1="118.7988" y2="118.7988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="108" x="714" y="3556.4648">Settlement DAO</text><ellipse cx="771" cy="3575.418" fill="#FEFECE" filter="url(#fzx7e7hkbe4ou)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="759" x2="783" y1="3589.418" y2="3589.418"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="90" x="891" y="134.334">Central Store</text><path d="M921,84.7988 C921,74.7988 939,74.7988 939,74.7988 C939,74.7988 957,74.7988 957,84.7988 L957,110.7988 C957,120.7988 939,120.7988 939,120.7988 C939,120.7988 921,120.7988 921,110.7988 L921,84.7988 " fill="#FEFECE" filter="url(#fzx7e7hkbe4ou)" style="stroke: #000000; stroke-width: 1.5;"/><path d="M921,84.7988 C921,94.7988 939,94.7988 939,94.7988 C939,94.7988 957,94.7988 957,84.7988 " fill="none" style="stroke: #000000; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="90" x="891" y="3556.4648">Central Store</text><path d="M921,3569.418 C921,3559.418 939,3559.418 939,3559.418 C939,3559.418 957,3559.418 957,3569.418 L957,3595.418 C957,3605.418 939,3605.418 939,3605.418 C939,3605.418 921,3605.418 921,3595.418 L921,3569.418 " fill="#FEFECE" filter="url(#fzx7e7hkbe4ou)" style="stroke: #000000; stroke-width: 1.5;"/><path d="M921,3569.418 C921,3579.418 939,3579.418 939,3579.418 C939,3579.418 957,3579.418 957,3569.418 " fill="none" style="stroke: #000000; stroke-width: 1.5;"/><rect fill="#FFFFFF" filter="url(#fzx7e7hkbe4ou)" height="3364.6426" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="160" y="147.2871"/><rect fill="#FFFFFF" filter="url(#fzx7e7hkbe4ou)" height="3364.6426" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="430" y="147.2871"/><rect fill="#FFFFFF" filter="url(#fzx7e7hkbe4ou)" height="183.1738" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="766" y="446.6348"/><rect fill="#FFFFFF" filter="url(#fzx7e7hkbe4ou)" height="198.4844" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="766" y="768.6719"/><rect fill="#FFFFFF" filter="url(#fzx7e7hkbe4ou)" height="167.8633" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="766" y="1106.0195"/><rect fill="#FFFFFF" filter="url(#fzx7e7hkbe4ou)" height="167.8633" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="766" y="1412.7461"/><rect fill="#FFFFFF" filter="url(#fzx7e7hkbe4ou)" height="587.248" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="766" y="1740.4727"/><rect fill="#FFFFFF" filter="url(#fzx7e7hkbe4ou)" height="372.9004" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="766" y="2372.3418"/><rect fill="#FFFFFF" filter="url(#fzx7e7hkbe4ou)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="934" y="475.9453"/><rect fill="#FFFFFF" filter="url(#fzx7e7hkbe4ou)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="934" y="797.9824"/><rect fill="#FFFFFF" filter="url(#fzx7e7hkbe4ou)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="934" y="1135.3301"/><rect fill="#FFFFFF" filter="url(#fzx7e7hkbe4ou)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="934" y="1442.0566"/><rect fill="#FFFFFF" filter="url(#fzx7e7hkbe4ou)" height="536.627" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="934" y="1769.7832"/><rect fill="#FFFFFF" filter="url(#fzx7e7hkbe4ou)" height="322.2793" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="934" y="2401.6523"/><path d="M13,154.2871 L422,154.2871 L422,161.2871 L412,171.2871 L13,171.2871 L13,154.2871 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="3372.6426" style="stroke: #000000; stroke-width: 2.0;" width="1233" x="13" y="154.2871"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="364" x="28" y="167.8555">Get Settlement By Settlement, Participant and Account</text><path d="M103,178.5977 L165,178.5977 L165,185.5977 L155,195.5977 L103,195.5977 L103,178.5977 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="123.8633" style="stroke: #000000; stroke-width: 2.0;" width="420.5" x="103" y="178.5977"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="17" x="118" y="192.166">alt</text><polygon fill="#A80036" points="418,228.5293,428,232.5293,418,236.5293,422,232.5293" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="170" x2="424" y1="232.5293" y2="232.5293"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="177" y="220.1318">1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="222" x="190" y="212.4766">GET - /settlements/{settlementId}/</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="170" x="190" y="227.7871">participants/{participantId}</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="103" x2="523.5" y1="241.5293" y2="241.5293"/><polygon fill="#A80036" points="418,290.4609,428,294.4609,418,298.4609,422,294.4609" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="170" x2="424" y1="294.4609" y2="294.4609"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="177" y="274.4082">2</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="222" x="190" y="259.0977">GET - /settlements/{settlementId}/</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="177" x="190" y="274.4082">participants/{participantId}/</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="134" x="190" y="289.7188">accounts/{accountId}</text><path d="M445,314.4609 L445,400.4609 L810,400.4609 L810,324.4609 L800,314.4609 L445,314.4609 " fill="#D3D3D3" filter="url(#fzx7e7hkbe4ou)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M800,314.4609 L800,324.4609 L810,324.4609 L800,314.4609 " fill="#D3D3D3" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="174" x="451" y="332.0293">let settlementFound = false</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="254" x="451" y="347.3398">let participantFoundInSettlement = false</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="230" x="451" y="362.6504">let accountProvided = accountId &gt; 0</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="344" x="451" y="377.9609">let participantAndAccountMatched = !accountProvided</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="314" x="451" y="393.2715">let accountFoundInSettlement = !accountProvided</text><polygon fill="#A80036" points="754,442.6348,764,446.6348,754,450.6348,758,446.6348" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="440" x2="760" y1="446.6348" y2="446.6348"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="447" y="434.2373">3</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="156" x="460" y="426.582">Request settlement state</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="73" x="460" y="441.8926">Error code:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="537" y="441.8926">2001</text><polygon fill="#A80036" points="922,471.9453,932,475.9453,922,479.9453,926,475.9453" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="776" x2="928" y1="475.9453" y2="475.9453"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="783" y="471.2031">4</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="121" x="796" y="471.2031">Retrieve settlement</text><polygon fill="#FFFFE0" filter="url(#fzx7e7hkbe4ou)" points="718,518.9453,1159,518.9453,1169,560.9453,1159,602.9453,718,602.9453,708,560.9453,718,518.9453" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="437" x="720" y="535.5137">SELECT s.settlementId, ssc.settlementStateId, s.reason, s.createdDate</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="36" x="720" y="550.8242">FROM</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="72" x="760" y="550.8242">settlement</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="7" x="836" y="550.8242">s</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="28" x="720" y="566.1348">JOIN</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="157" x="752" y="566.1348">settlementStateChange</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="21" x="913" y="566.1348">ssc</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="370" x="720" y="581.4453">ON ssc.settlementStateChangeId = s.currentStateChangeId</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="175" x="720" y="596.7559">WHERE s.settlementId = {id}</text><polygon fill="#A80036" points="451,625.8086,441,629.8086,451,633.8086,447,629.8086" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="445" x2="770" y1="629.8086" y2="629.8086"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="457" y="625.0664">5</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="41" x="470" y="625.0664">Return</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="72" x="515" y="625.0664">settlement</text><path d="M445,642.8086 L445,697.8086 L645,697.8086 L645,652.8086 L635,642.8086 L445,642.8086 " fill="#D3D3D3" filter="url(#fzx7e7hkbe4ou)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M635,642.8086 L635,652.8086 L645,652.8086 L635,642.8086 " fill="#D3D3D3" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="179" x="451" y="660.377">if (settlement.settlementId) {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="467" y="675.6875"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="114" x="467" y="675.6875">settlementFound</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="39" x="585" y="675.6875">= true</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="451" y="690.998">}</text><path d="M326.5,714.7402 L393.5,714.7402 L393.5,721.7402 L383.5,731.7402 L326.5,731.7402 L326.5,714.7402 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="957.8008" style="stroke: #000000; stroke-width: 2.0;" width="813.5" x="326.5" y="714.7402"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="22" x="341.5" y="728.3086">opt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="100" x="408.5" y="727.375">[settlementFound]</text><polygon fill="#A80036" points="754,764.6719,764,768.6719,754,772.6719,758,768.6719" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="440" x2="760" y1="768.6719" y2="768.6719"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="447" y="756.2744">6</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="111" x="460" y="748.6191">Check participant</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="73" x="460" y="763.9297">Error code:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="537" y="763.9297">2001</text><polygon fill="#A80036" points="922,793.9824,932,797.9824,922,801.9824,926,797.9824" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="776" x2="928" y1="797.9824" y2="797.9824"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="783" y="793.2402">7</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="81" x="796" y="793.2402">Check exists</text><polygon fill="#FFFFE0" filter="url(#fzx7e7hkbe4ou)" points="757,840.9824,1120,840.9824,1130,889.9824,1120,939.9824,757,939.9824,747,889.9824,757,840.9824" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="251" x="759" y="857.5508">SELECT settlementParticipantCurrencyId</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="36" x="759" y="872.8613">FROM</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="207" x="799" y="872.8613">settlementParticipantCurrency</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="22" x="1010" y="872.8613">spc</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="28" x="759" y="888.1719">JOIN</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="136" x="791" y="888.1719">participantCurrency</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="15" x="931" y="888.1719">pc</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="359" x="759" y="903.4824">ON pc.participantCurrencyId = spc.participantCurrencyId</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="190" x="759" y="918.793">WHERE spc.settlementId = {id}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="238" x="759" y="934.1035">AND pc.participantId = {participantId}</text><polygon fill="#A80036" points="451,963.1563,441,967.1563,451,971.1563,447,967.1563" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="445" x2="770" y1="967.1563" y2="967.1563"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="457" y="962.4141">8</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="41" x="470" y="962.4141">Return</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="244" x="515" y="962.4141">settlementParticipantCurrencyIdList</text><path d="M445,980.1563 L445,1035.1563 L790,1035.1563 L790,990.1563 L780,980.1563 L445,980.1563 " fill="#D3D3D3" filter="url(#fzx7e7hkbe4ou)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M780,980.1563 L780,990.1563 L790,990.1563 L780,980.1563 " fill="#D3D3D3" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="324" x="451" y="997.7246">if (settlementParticipantCurrencyIdList.length &gt; 0) {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="467" y="1013.0352"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="201" x="467" y="1013.0352">participantFoundInSettlement</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="39" x="672" y="1013.0352">= true</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="451" y="1028.3457">}</text><path d="M336.5,1052.0879 L403.5,1052.0879 L403.5,1059.0879 L393.5,1069.0879 L336.5,1069.0879 L336.5,1052.0879 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="613.4531" style="stroke: #000000; stroke-width: 2.0;" width="772.5" x="336.5" y="1052.0879"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="22" x="351.5" y="1065.6563">opt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="288" x="418.5" y="1064.7227">[participantFoundInSettlement &amp;&amp; accountProvided]</text><polygon fill="#A80036" points="754,1102.0195,764,1106.0195,754,1110.0195,758,1106.0195" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="440" x2="760" y1="1106.0195" y2="1106.0195"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="447" y="1093.6221">9</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="111" x="460" y="1085.9668">Check participant</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="73" x="460" y="1101.2773">Error code:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="537" y="1101.2773">2001</text><polygon fill="#A80036" points="922,1131.3301,932,1135.3301,922,1139.3301,926,1135.3301" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="776" x2="928" y1="1135.3301" y2="1135.3301"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="783" y="1130.5879">10</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="81" x="805" y="1130.5879">Check exists</text><polygon fill="#FFFFE0" filter="url(#fzx7e7hkbe4ou)" points="801,1178.3301,1076,1178.3301,1086,1212.3301,1076,1247.3301,801,1247.3301,791,1212.3301,801,1178.3301" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="185" x="803" y="1194.8984">SELECT participantCurrencyId</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="28" x="803" y="1210.209">JOIN</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="136" x="835" y="1210.209">participantCurrency</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="271" x="803" y="1225.5195">WHERE participantCurrencyId = {accountId}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="219" x="803" y="1240.8301">AND participantId = {participantId}</text><polygon fill="#A80036" points="451,1269.8828,441,1273.8828,451,1277.8828,447,1273.8828" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="445" x2="770" y1="1273.8828" y2="1273.8828"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="457" y="1269.1406">11</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="41" x="479" y="1269.1406">Return</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="53" x="524" y="1269.1406">account</text><path d="M445,1286.8828 L445,1341.8828 L740,1341.8828 L740,1296.8828 L730,1286.8828 L445,1286.8828 " fill="#D3D3D3" filter="url(#fzx7e7hkbe4ou)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M730,1286.8828 L730,1296.8828 L740,1296.8828 L730,1286.8828 " fill="#D3D3D3" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="79" x="451" y="1304.4512">if (account) {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="467" y="1319.7617"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="215" x="467" y="1319.7617">participantAndAccountMatched</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="39" x="686" y="1319.7617">= true</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="451" y="1335.0723">}</text><path d="M346.5,1358.8145 L413.5,1358.8145 L413.5,1365.8145 L403.5,1375.8145 L346.5,1375.8145 L346.5,1358.8145 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="299.7266" style="stroke: #000000; stroke-width: 2.0;" width="752.5" x="346.5" y="1358.8145"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="22" x="361.5" y="1372.3828">opt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="181" x="428.5" y="1371.4492">[participantAndAccountMatched]</text><polygon fill="#A80036" points="754,1408.7461,764,1412.7461,754,1416.7461,758,1412.7461" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="440" x2="760" y1="1412.7461" y2="1412.7461"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="447" y="1400.3486">12</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="180" x="469" y="1392.6934">Check account in settlement</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="73" x="469" y="1408.0039">Error code:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="546" y="1408.0039">2001</text><polygon fill="#A80036" points="922,1438.0566,932,1442.0566,922,1446.0566,926,1442.0566" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="776" x2="928" y1="1442.0566" y2="1442.0566"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="783" y="1437.3145">13</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="81" x="805" y="1437.3145">Check exists</text><polygon fill="#FFFFE0" filter="url(#fzx7e7hkbe4ou)" points="799,1485.0566,1079,1485.0566,1089,1519.0566,1079,1554.0566,799,1554.0566,789,1519.0566,799,1485.0566" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="251" x="801" y="1501.625">SELECT settlementParticipantCurrencyId</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="36" x="801" y="1516.9355">FROM</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="207" x="841" y="1516.9355">settlementParticipantCurrency</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="190" x="801" y="1532.2461">WHERE spc.settlementId = {id}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="276" x="801" y="1547.5566">AND pc.participantCurrencyId = {accountId}</text><polygon fill="#A80036" points="451,1576.6094,441,1580.6094,451,1584.6094,447,1580.6094" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="445" x2="770" y1="1580.6094" y2="1580.6094"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="457" y="1575.8672">14</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="41" x="479" y="1575.8672">Return</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="220" x="524" y="1575.8672">settlementParticipantCurrencyId</text><path d="M445,1593.6094 L445,1648.6094 L705,1648.6094 L705,1603.6094 L695,1593.6094 L445,1593.6094 " fill="#D3D3D3" filter="url(#fzx7e7hkbe4ou)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M695,1593.6094 L695,1603.6094 L705,1603.6094 L695,1593.6094 " fill="#D3D3D3" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="231" x="451" y="1611.1777">if (settlementParticipantCurrencyId) {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="467" y="1626.4883"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="180" x="467" y="1626.4883">accountFoundInSettlement</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="39" x="651" y="1626.4883">= true</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="451" y="1641.7988">}</text><path d="M23,1686.541 L85,1686.541 L85,1693.541 L75,1703.541 L23,1703.541 L23,1686.541 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="1833.3887" style="stroke: #000000; stroke-width: 2.0;" width="1213" x="23" y="1686.541"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="17" x="38" y="1700.1094">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="654" x="100" y="1699.1758">[settlementFound &amp;&amp; participantFoundInSettlement &amp;&amp; participantAndAccountMatched &amp;&amp; accountFoundInSettlement]</text><polygon fill="#A80036" points="754,1736.4727,764,1740.4727,754,1744.4727,758,1740.4727" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="440" x2="760" y1="1740.4727" y2="1740.4727"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="447" y="1728.0752">15</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="180" x="469" y="1720.4199">Request settlement windows</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="73" x="469" y="1735.7305">Error code:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="546" y="1735.7305">2001</text><polygon fill="#A80036" points="922,1765.7832,932,1769.7832,922,1773.7832,926,1769.7832" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="776" x2="928" y1="1769.7832" y2="1769.7832"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="783" y="1765.041">16</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="109" x="805" y="1765.041">Retrieve windows</text><path d="M682,1784.7832 L744,1784.7832 L744,1791.7832 L734,1801.7832 L682,1801.7832 L682,1784.7832 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="514.627" style="stroke: #000000; stroke-width: 2.0;" width="514" x="682" y="1784.7832"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="17" x="697" y="1798.3516">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="101" x="759" y="1797.418">[accountProvided]</text><polygon fill="#FFFFE0" filter="url(#fzx7e7hkbe4ou)" points="702,1807.0938,1176,1807.0938,1186,1910.0938,1176,2014.0938,702,2014.0938,692,1910.0938,702,1807.0938" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="45" x="704" y="1823.6621">SELECT</text><text fill="#0000AA" font-family="sans-serif" font-size="13" font-style="italic" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="62" x="753" y="1823.6621">DISTINCT</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="355" x="819" y="1823.6621">sw.settlementWindowId, swsc.settlementWindowStateId,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="385" x="720" y="1838.9727">swsc.reason, sw.createdDate, swsc.createdDate changedDate</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="36" x="704" y="1854.2832">FROM</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="197" x="744" y="1854.2832">settlementSettlementWindow</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="24" x="945" y="1854.2832">ssw</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="28" x="704" y="1869.5938">JOIN</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="125" x="736" y="1869.5938">settlementWindow</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="17" x="865" y="1869.5938">sw</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="347" x="704" y="1884.9043">ON sw.settlementWindowId = ssw.settlementWindowId</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="28" x="704" y="1900.2148">JOIN</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="210" x="736" y="1900.2148">settlementWindowStateChange</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="31" x="950" y="1900.2148">swsc</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="439" x="704" y="1915.5254">ON swsc.settlementWindowStateChangeId = sw.currentStateChangeId</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="28" x="704" y="1930.8359">JOIN</text><text fill="#0000AA" font-family="sans-serif" font-size="13" font-style="italic" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="178" x="736" y="1930.8359">settlementWindowContent</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="24" x="918" y="1930.8359">swc</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="347" x="704" y="1946.1465">ON swc.settlementWindowId = sw.settlementWindowId</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="28" x="704" y="1961.457">JOIN</text><text fill="#0000AA" font-family="sans-serif" font-size="13" font-style="italic" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="263" x="736" y="1961.457">settlementWindowContentAggregation</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="31" x="1003" y="1961.457">swca</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="461" x="704" y="1976.7676">ON swca.settlementWindowContentId = swc.settlementWindowContentId</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="218" x="704" y="1992.0781">AND swca.participantCurrencyId =</text><text fill="#0000AA" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="70" x="926" y="1992.0781">{accountId}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="192" x="704" y="2007.3887">WHERE ssw.settlementId = {id}</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="682" x2="1196" y1="2020.1309" y2="2020.1309"/><polygon fill="#FFFFE0" filter="url(#fzx7e7hkbe4ou)" points="703,2026.1309,1175,2026.1309,1185,2160.1309,1175,2294.1309,703,2294.1309,693,2160.1309,703,2026.1309" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="468" x="705" y="2042.6992">SELECT DISTINCT sw.settlementWindowId, swsc.settlementWindowStateId,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="385" x="721" y="2058.0098">swsc.reason, sw.createdDate, swsc.createdDate changedDate</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="36" x="705" y="2073.3203">FROM</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="197" x="745" y="2073.3203">settlementSettlementWindow</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="24" x="946" y="2073.3203">ssw</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="28" x="705" y="2088.6309">JOIN</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="125" x="737" y="2088.6309">settlementWindow</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="17" x="866" y="2088.6309">sw</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="347" x="705" y="2103.9414">ON sw.settlementWindowId = ssw.settlementWindowId</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="28" x="705" y="2119.252">JOIN</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="210" x="737" y="2119.252">settlementWindowStateChange</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="31" x="951" y="2119.252">swsc</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="439" x="705" y="2134.5625">ON swsc.settlementWindowStateChangeId = sw.currentStateChangeId</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="28" x="705" y="2149.873">JOIN</text><text fill="#0000AA" font-family="sans-serif" font-size="13" font-style="italic" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="178" x="737" y="2149.873">settlementWindowContent</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="24" x="919" y="2149.873">swc</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="347" x="705" y="2165.1836">ON swc.settlementWindowId = sw.settlementWindowId</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="28" x="705" y="2180.4941">JOIN</text><text fill="#0000AA" font-family="sans-serif" font-size="13" font-style="italic" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="263" x="737" y="2180.4941">settlementWindowContentAggregation</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="31" x="1004" y="2180.4941">swca</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="461" x="705" y="2195.8047">ON swca.settlementWindowContentId = swc.settlementWindowContentId</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="226" x="705" y="2211.1152">AND swca.participantCurrencyId IN(</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="185" x="721" y="2226.4258">SELECT participantCurrencyId</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="164" x="721" y="2241.7363">FROM participantCurrency</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="141" x="721" y="2257.0469">WHERE participantId =</text><text fill="#0000AA" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="88" x="866" y="2257.0469">{participantId}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="705" y="2272.3574">)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="192" x="705" y="2287.668">WHERE ssw.settlementId = {id}</text><polygon fill="#A80036" points="451,2323.7207,441,2327.7207,451,2331.7207,447,2327.7207" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="445" x2="770" y1="2327.7207" y2="2327.7207"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="457" y="2322.9785">17</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="41" x="479" y="2322.9785">Return</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="59" x="524" y="2322.9785">windows</text><polygon fill="#A80036" points="754,2368.3418,764,2372.3418,754,2376.3418,758,2372.3418" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="440" x2="760" y1="2372.3418" y2="2372.3418"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="447" y="2359.9443">18</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="182" x="469" y="2352.2891">Request settlement accounts</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="73" x="469" y="2367.5996">Error code:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="546" y="2367.5996">2001</text><polygon fill="#A80036" points="922,2397.6523,932,2401.6523,922,2405.6523,926,2401.6523" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="776" x2="928" y1="2401.6523" y2="2401.6523"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="783" y="2396.9102">19</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="111" x="805" y="2396.9102">Retrieve accounts</text><path d="M652,2416.6523 L714,2416.6523 L714,2423.6523 L704,2433.6523 L652,2433.6523 L652,2416.6523 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="300.2793" style="stroke: #000000; stroke-width: 2.0;" width="574" x="652" y="2416.6523"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="17" x="667" y="2430.2207">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="101" x="729" y="2429.2871">[accountProvided]</text><polygon fill="#FFFFE0" filter="url(#fzx7e7hkbe4ou)" points="675,2438.9629,1202,2438.9629,1212,2503.9629,1202,2568.9629,675,2568.9629,665,2503.9629,675,2438.9629" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="480" x="677" y="2455.5313">SELECT pc.participantId, spc.participantCurrencyId, spcsc.settlementStateId,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="279" x="693" y="2470.8418">spcsc.reason, spc.netAmount, pc.currencyId</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="36" x="677" y="2486.1523">FROM</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="207" x="717" y="2486.1523">settlementParticipantCurrency</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="22" x="928" y="2486.1523">spc</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="28" x="677" y="2501.4629">JOIN</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="292" x="709" y="2501.4629">settlementParticipantCurrencyStateChange</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="36" x="1005" y="2501.4629">spcsc</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="523" x="677" y="2516.7734">ON spcsc.settlementParticipantCurrencyStateChangeId = spc.currentStateChangeId</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="28" x="677" y="2532.084">JOIN</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="136" x="709" y="2532.084">participantCurrency</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="15" x="849" y="2532.084">pc</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="359" x="677" y="2547.3945">ON pc.participantCurrencyId = spc.participantCurrencyId</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="503" x="677" y="2562.7051">WHERE spc.settlementParticipantCurrencyId = {settlementParticipantCurrencyId}</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="652" x2="1226" y1="2575.4473" y2="2575.4473"/><polygon fill="#FFFFE0" filter="url(#fzx7e7hkbe4ou)" points="672,2581.4473,1206,2581.4473,1216,2646.4473,1206,2711.4473,672,2711.4473,662,2646.4473,672,2581.4473" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="480" x="674" y="2598.0156">SELECT pc.participantId, spc.participantCurrencyId, spcsc.settlementStateId,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="279" x="690" y="2613.3262">spcsc.reason, spc.netAmount, pc.currencyId</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="36" x="674" y="2628.6367">FROM</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="207" x="714" y="2628.6367">settlementParticipantCurrency</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="22" x="925" y="2628.6367">spc</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="28" x="674" y="2643.9473">JOIN</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="292" x="706" y="2643.9473">settlementParticipantCurrencyStateChange</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="36" x="1002" y="2643.9473">spcsc</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="523" x="674" y="2659.2578">ON spcsc.settlementParticipantCurrencyStateChangeId = spc.currentStateChangeId</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="28" x="674" y="2674.5684">JOIN</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="136" x="706" y="2674.5684">participantCurrency</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="15" x="846" y="2674.5684">pc</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="359" x="674" y="2689.8789">ON pc.participantCurrencyId = spc.participantCurrencyId</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="530" x="674" y="2705.1895">WHERE spc.settlementParticipantCurrencyId IN {settlementParticipantCurrencyIdList}</text><polygon fill="#A80036" points="451,2741.2422,441,2745.2422,451,2749.2422,447,2745.2422" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="445" x2="770" y1="2745.2422" y2="2745.2422"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="457" y="2740.5">20</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="41" x="479" y="2740.5">Return</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="60" x="524" y="2740.5">accounts</text><path d="M33,2758.2422 L33,2783.2422 L421,2783.2422 L421,2768.2422 L411,2758.2422 L33,2758.2422 " fill="#D3D3D3" filter="url(#fzx7e7hkbe4ou)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M411,2758.2422 L411,2768.2422 L421,2768.2422 L411,2758.2422 " fill="#D3D3D3" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="367" x="39" y="2775.8105">Are we going to report window content related info below?</text><path d="M72,2797.5527 L72,3281.5527 L421,3281.5527 L421,2807.5527 L411,2797.5527 L72,2797.5527 " fill="#FFFF00" filter="url(#fzx7e7hkbe4ou)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M411,2797.5527 L411,2807.5527 L421,2807.5527 L411,2797.5527 " fill="#FFFF00" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="78" y="2815.1211">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="184" x="94" y="2830.4316">"id": settlement.settlementId,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="234" x="94" y="2845.7422">"state": settlement.settlementStateId,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="145" x="94" y="2861.0527">"settlementWindows": [</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="110" y="2876.3633">[</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="126" y="2891.6738">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="214" x="142" y="2906.9844">"id": window.settlementWindowId,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="158" x="142" y="2922.2949">"reason": window.reason,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="264" x="142" y="2937.6055">"state": window.settlementWindowStateId,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="224" x="142" y="2952.916">"createdDate": window.createdDate,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="234" x="142" y="2968.2266">"changedDate": window.changedDate</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="126" y="2983.5371">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="110" y="2998.8477">]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="94" y="3014.1582">],</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="97" x="94" y="3029.4688">"participants": [</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="110" y="3044.7793">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="168" x="126" y="3060.0898">"id": account.participantId,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="79" x="126" y="3075.4004">"accounts": [</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="142" y="3090.7109">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="224" x="158" y="3106.0215">"id": account.participantCurrencyId,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="160" x="158" y="3121.332">"reason": account.reason,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="217" x="158" y="3136.6426">"state": account.settlementStateId,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="159" x="158" y="3151.9531">"netSettlementAmount": {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="194" x="174" y="3167.2637">"amount": account.netAmount,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="192" x="174" y="3182.5742">"currency": account.currencyId</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="158" y="3197.8848">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="142" y="3213.1953">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="126" y="3228.5059">]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="110" y="3243.8164">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="94" y="3259.127">]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="78" y="3274.4375">}</text><polygon fill="#A80036" points="181,3308.4902,171,3312.4902,181,3316.4902,177,3312.4902" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="175" x2="429" y1="3312.4902" y2="3312.4902"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="187" y="3307.748">21</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="161" x="209" y="3307.748">Respond HTTP - 200 (OK)</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="23" x2="1236" y1="3321.4902" y2="3321.4902"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="642" x="28" y="3332.125">[!settlementFound || !participantFoundInSettlement || !participantAndAccountMatched || !accountFoundInSettlement]</text><path d="M445,3340.4453 L445,3365.4453 L709,3365.4453 L709,3350.4453 L699,3340.4453 L445,3340.4453 " fill="#D3D3D3" filter="url(#fzx7e7hkbe4ou)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M699,3340.4453 L699,3350.4453 L709,3350.4453 L699,3340.4453 " fill="#D3D3D3" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="243" x="451" y="3358.0137">Log ERROR event (based on the failure)</text><path d="M91,3379.7559 L91,3480.7559 L421,3480.7559 L421,3389.7559 L411,3379.7559 L91,3379.7559 " fill="#FFFF00" filter="url(#fzx7e7hkbe4ou)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M411,3379.7559 L411,3389.7559 L421,3389.7559 L411,3379.7559 " fill="#FFFF00" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="97" y="3397.3242">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="116" x="113" y="3412.6348">errorInformation: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="148" x="129" y="3427.9453">"errorCode": &lt;integer&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="277" x="129" y="3443.2559">"errorDescription": "Client error description"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="113" y="3458.5664">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="97" y="3473.877">}</text><polygon fill="#A80036" points="176,3507.9297,166,3511.9297,176,3515.9297,172,3511.9297" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="170" x2="434" y1="3511.9297" y2="3511.9297"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="182" y="3507.1875">22</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="214" x="204" y="3507.1875">Respond HTTP - 4xx (Client error)</text><!--
@startuml
title 6.2.3. Get Settlement By Settlement, Participant and Account (getSettlementBySettlementParticipantAccount)
autonumber

actor "Hub Employee" as OPERATOR
boundary "Settlement Service API" as SSAPI
entity "Settlement DAO" as SETTLE_DAO
database "Central Store" as DB

box "Central HUB" #lightpink
    participant OPERATOR
end box

box "Settlement Service" #lightgreen
    participant SSAPI
    participant SETTLE_DAO
end box

box "Central Services" #lightyellow
    participant DB
end box

group Get Settlement By Settlement, Participant and Account
activate OPERATOR
    alt
        OPERATOR -> SSAPI: GET - /settlements/{settlementId}/\nparticipants/{participantId}
    else
        OPERATOR -> SSAPI: GET - /settlements/{settlementId}/\nparticipants/{participantId}/\naccounts/{accountId}
    end

    activate SSAPI

    note right of SSAPI #lightgray
        let settlementFound = false
        let participantFoundInSettlement = false
        let accountProvided = accountId > 0
        let participantAndAccountMatched = !accountProvided
        let accountFoundInSettlement = !accountProvided
    end note
    SSAPI-> SETTLE_DAO: Request settlement state\n<color #FF0000><b>Error code:</b> 2001</color>
    activate SETTLE_DAO
    SETTLE_DAO -> DB: Retrieve settlement
    activate DB
    hnote over DB #lightyellow
        SELECT s.settlementId, ssc.settlementStateId, s.reason, s.createdDate
        FROM **settlement** s
        JOIN **settlementStateChange** ssc
        ON ssc.settlementStateChangeId = s.currentStateChangeId
        WHERE s.settlementId = {id}
    end hnote
    deactivate DB
    SSAPI <- - SETTLE_DAO: Return **settlement**
    deactivate SETTLE_DAO
    note right of SSAPI #lightgray
        if (settlement.settlementId) {
            **settlementFound** = true
        }
    end note

    opt settlementFound
        SSAPI-> SETTLE_DAO: Check participant\n<color #FF0000><b>Error code:</b> 2001</color>
        activate SETTLE_DAO
        SETTLE_DAO -> DB: Check exists
        activate DB
        hnote over DB #lightyellow
            SELECT settlementParticipantCurrencyId
            FROM **settlementParticipantCurrency** spc
            JOIN **participantCurrency** pc
            ON pc.participantCurrencyId = spc.participantCurrencyId
            WHERE spc.settlementId = {id}
            AND pc.participantId = {participantId}
        end hnote
        deactivate DB
        SSAPI <- - SETTLE_DAO: Return **settlementParticipantCurrencyIdList**
        deactivate SETTLE_DAO
        note right of SSAPI #lightgray
            if (settlementParticipantCurrencyIdList.length > 0) {
                **participantFoundInSettlement** = true
            }
        end note

        opt participantFoundInSettlement && accountProvided
            SSAPI-> SETTLE_DAO: Check participant\n<color #FF0000><b>Error code:</b> 2001</color>
            activate SETTLE_DAO
            SETTLE_DAO -> DB: Check exists
            activate DB
            hnote over DB #lightyellow
                SELECT participantCurrencyId
                JOIN **participantCurrency**
                WHERE participantCurrencyId = {accountId}
                AND participantId = {participantId}
            end hnote
            deactivate DB
            SSAPI <- - SETTLE_DAO: Return **account**
            deactivate SETTLE_DAO
            note right of SSAPI #lightgray
                if (account) {
                    **participantAndAccountMatched** = true
                }
            end note

            opt participantAndAccountMatched
                SSAPI-> SETTLE_DAO: Check account in settlement\n<color #FF0000><b>Error code:</b> 2001</color>
                activate SETTLE_DAO
                SETTLE_DAO -> DB: Check exists
                activate DB
                hnote over DB #lightyellow
                    SELECT settlementParticipantCurrencyId
                    FROM **settlementParticipantCurrency**
                    WHERE spc.settlementId = {id}
                    AND pc.participantCurrencyId = {accountId}
                end hnote
                deactivate DB
                SSAPI <- - SETTLE_DAO: Return **settlementParticipantCurrencyId**
                deactivate SETTLE_DAO

                note right of SSAPI #lightgray
                    if (settlementParticipantCurrencyId) {
                        **accountFoundInSettlement** = true
                    }
                end note
            end
        end
    end

    alt settlementFound && participantFoundInSettlement && participantAndAccountMatched && accountFoundInSettlement
        SSAPI-> SETTLE_DAO: Request settlement windows\n<color #FF0000><b>Error code:</b> 2001</color>
        activate SETTLE_DAO
        SETTLE_DAO -> DB: Retrieve windows
        activate DB
        alt accountProvided
            hnote over DB #lightyellow
                SELECT <color 00A>**//DISTINCT//**</color> sw.settlementWindowId, swsc.settlementWindowStateId,
                    swsc.reason, sw.createdDate, swsc.createdDate changedDate
                FROM **settlementSettlementWindow** ssw
                JOIN **settlementWindow** sw
                ON sw.settlementWindowId = ssw.settlementWindowId
                JOIN **settlementWindowStateChange** swsc
                ON swsc.settlementWindowStateChangeId = sw.currentStateChangeId
                JOIN <color 00A>**//settlementWindowContent//**</color> swc
                ON swc.settlementWindowId = sw.settlementWindowId
                JOIN <color 00A>**//settlementWindowContentAggregation//**</color> swca
                ON swca.settlementWindowContentId = swc.settlementWindowContentId
                AND swca.participantCurrencyId = <color 00A>//{accountId}//</color>
                WHERE ssw.settlementId = {id}
            end hnote
        else
            hnote over DB #lightyellow
                SELECT DISTINCT sw.settlementWindowId, swsc.settlementWindowStateId,
                    swsc.reason, sw.createdDate, swsc.createdDate changedDate
                FROM **settlementSettlementWindow** ssw
                JOIN **settlementWindow** sw
                ON sw.settlementWindowId = ssw.settlementWindowId
                JOIN **settlementWindowStateChange** swsc
                ON swsc.settlementWindowStateChangeId = sw.currentStateChangeId
                JOIN <color 00A>**//settlementWindowContent//**</color> swc
                ON swc.settlementWindowId = sw.settlementWindowId
                JOIN <color 00A>**//settlementWindowContentAggregation//**</color> swca
                ON swca.settlementWindowContentId = swc.settlementWindowContentId
                AND swca.participantCurrencyId IN(
                    SELECT participantCurrencyId
                    FROM participantCurrency
                    WHERE participantId = <color 00A>//{participantId}//</color>
                )
                WHERE ssw.settlementId = {id}
            end hnote
        end
        deactivate DB
        SSAPI <- - SETTLE_DAO: Return **windows**
        deactivate SETTLE_DAO

        SSAPI-> SETTLE_DAO: Request settlement accounts\n<color #FF0000><b>Error code:</b> 2001</color>
        activate SETTLE_DAO
        SETTLE_DAO -> DB: Retrieve accounts
        activate DB
        alt accountProvided
            hnote over DB #lightyellow
                SELECT pc.participantId, spc.participantCurrencyId, spcsc.settlementStateId, 
                    spcsc.reason, spc.netAmount, pc.currencyId
                FROM **settlementParticipantCurrency** spc
                JOIN **settlementParticipantCurrencyStateChange** spcsc
                ON spcsc.settlementParticipantCurrencyStateChangeId = spc.currentStateChangeId
                JOIN **participantCurrency** pc
                ON pc.participantCurrencyId = spc.participantCurrencyId
                WHERE spc.settlementParticipantCurrencyId = {settlementParticipantCurrencyId}
            end hnote
        else
            hnote over DB #lightyellow
                SELECT pc.participantId, spc.participantCurrencyId, spcsc.settlementStateId, 
                    spcsc.reason, spc.netAmount, pc.currencyId
                FROM **settlementParticipantCurrency** spc
                JOIN **settlementParticipantCurrencyStateChange** spcsc
                ON spcsc.settlementParticipantCurrencyStateChangeId = spc.currentStateChangeId
                JOIN **participantCurrency** pc
                ON pc.participantCurrencyId = spc.participantCurrencyId
                WHERE spc.settlementParticipantCurrencyId IN {settlementParticipantCurrencyIdList}
            end hnote
        end
        deactivate DB
        SSAPI <- - SETTLE_DAO: Return **accounts**
        deactivate SETTLE_DAO

        note left of SSAPI #lightgray
            <color #red>Are we going to report window content related info below?</color>
        end note
        note left of SSAPI #yellow
            {
                "id": settlement.settlementId,
                "state": settlement.settlementStateId,
                "settlementWindows": [
                    [
                        {
                            "id": window.settlementWindowId,
                            "reason": window.reason,
                            "state": window.settlementWindowStateId,
                            "createdDate": window.createdDate,
                            "changedDate": window.changedDate
                        }
                    ]
                ],
                "participants": [
                    {
                        "id": account.participantId,
                        "accounts": [
                            {
                                "id": account.participantCurrencyId,
                                "reason": account.reason,
                                "state": account.settlementStateId,
                                "netSettlementAmount": {
                                    "amount": account.netAmount,
                                    "currency": account.currencyId
                                }
                            }
                        ]
                    }
                ]
            }
        end note
        OPERATOR <- - SSAPI: Respond HTTP - 200 (OK)
    else !settlementFound || !participantFoundInSettlement || !participantAndAccountMatched || !accountFoundInSettlement
        note right of SSAPI #lightgray
            Log ERROR event (based on the failure)
        end note
        note left of SSAPI #yellow
            {
                errorInformation: {
                    "errorCode": <integer>,
                    "errorDescription": "Client error description"
                }
            }
        end note
        OPERATOR <- - SSAPI: Respond HTTP - 4xx (Client error)
        deactivate SSAPI
        deactivate OPERATOR
    end
end
@enduml

PlantUML version 1.2018.05(Sat May 05 23:00:17 EEST 2018)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Java Version: 1.8.0_131-b11
Operating System: Mac OS X
OS Version: 10.15.1
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>