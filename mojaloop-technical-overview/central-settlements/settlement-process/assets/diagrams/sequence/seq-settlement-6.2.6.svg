<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="3473px" preserveAspectRatio="none" style="width:1355px;height:3473px;" version="1.1" viewBox="0 0 1355 3473" width="1355px" zoomAndPan="magnify"><defs><filter height="300%" id="f1ddi6eat7xrzm" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="326" x="515.5" y="23.5352">6.2.6. Settlement Abort (abortSettlementById)</text><rect fill="#FFB6C1" height="3428.123" style="stroke: #A80036; stroke-width: 1.0;" width="112" x="146" y="34.4883"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="81" x="161.5" y="47.0566">Central HUB</text><rect fill="#90EE90" height="3428.123" style="stroke: #A80036; stroke-width: 1.0;" width="408.5" x="339.5" y="34.4883"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="124" x="481.75" y="47.0566">Settlement Service</text><rect fill="#FFFFE0" height="3428.123" style="stroke: #A80036; stroke-width: 1.0;" width="114" x="994" y="34.4883"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="108" x="997" y="47.0566">Central Services</text><rect fill="#FFFFFF" filter="url(#f1ddi6eat7xrzm)" height="3218.8359" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="197" y="147.2871"/><rect fill="#FFFFFF" filter="url(#f1ddi6eat7xrzm)" height="3065.9727" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="417" y="278.1504"/><rect fill="#FFFFFF" filter="url(#f1ddi6eat7xrzm)" height="2665.3828" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="682" y="322.7715"/><rect fill="#FFFFFF" filter="url(#f1ddi6eat7xrzm)" height="139.1738" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1046" y="352.082"/><rect fill="#FFFFFF" filter="url(#f1ddi6eat7xrzm)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1046" y="755.1816"/><rect fill="#FFFFFF" filter="url(#f1ddi6eat7xrzm)" height="154.4844" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1046" y="1000.9316"/><rect fill="#FFFFFF" filter="url(#f1ddi6eat7xrzm)" height="231.0371" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1046" y="1363.2109"/><rect fill="#FFFFFF" filter="url(#f1ddi6eat7xrzm)" height="185.1055" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1046" y="1623.5586"/><rect fill="#FFFFFF" filter="url(#f1ddi6eat7xrzm)" height="62.6211" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1046" y="1862.2852"/><rect fill="#FFFFFF" filter="url(#f1ddi6eat7xrzm)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1046" y="1996.5273"/><rect fill="#FFFFFF" filter="url(#f1ddi6eat7xrzm)" height="77.9316" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1046" y="2227.3223"/><rect fill="#FFFFFF" filter="url(#f1ddi6eat7xrzm)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1046" y="2376.875"/><rect fill="#FFFFFF" filter="url(#f1ddi6eat7xrzm)" height="62.6211" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1046" y="2500.8066"/><rect fill="#FFFFFF" filter="url(#f1ddi6eat7xrzm)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1046" y="2635.0488"/><rect fill="#FFFFFF" filter="url(#f1ddi6eat7xrzm)" height="93.2422" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1046" y="2758.9805"/><rect fill="#FFFFFF" filter="url(#f1ddi6eat7xrzm)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1046" y="2881.5332"/><rect fill="#FFFFFF" filter="url(#f1ddi6eat7xrzm)" height="3204.8359" style="stroke: #000000; stroke-width: 2.0;" width="1331" x="13" y="154.2871"/><rect fill="#FFFFFF" filter="url(#f1ddi6eat7xrzm)" height="804.334" style="stroke: #000000; stroke-width: 2.0;" width="724" x="610" y="506.2559"/><rect fill="#FFFFFF" filter="url(#f1ddi6eat7xrzm)" height="133.1738" style="stroke: #000000; stroke-width: 2.0;" width="380" x="687" y="554.4316"/><rect fill="#FFFFFF" height="270.0605" style="stroke: none; stroke-width: 1.0;" width="724" x="610" y="694.6055"/><rect fill="#FFFFFF" filter="url(#f1ddi6eat7xrzm)" height="241.1055" style="stroke: #000000; stroke-width: 2.0;" width="594" x="620" y="716.5605"/><rect fill="#FFFFFF" height="345.9238" style="stroke: none; stroke-width: 1.0;" width="724" x="610" y="964.666"/><rect fill="#FFFFFF" filter="url(#f1ddi6eat7xrzm)" height="133.1738" style="stroke: #000000; stroke-width: 2.0;" width="494" x="687" y="1170.416"/><rect fill="#FFFFFF" filter="url(#f1ddi6eat7xrzm)" height="1635.2539" style="stroke: #000000; stroke-width: 2.0;" width="682" x="610" y="1324.5898"/><rect fill="#FFFFFF" filter="url(#f1ddi6eat7xrzm)" height="244.1738" style="stroke: #000000; stroke-width: 2.0;" width="656" x="620" y="1823.6641"/><rect fill="#FFFFFF" filter="url(#f1ddi6eat7xrzm)" height="274.7949" style="stroke: #000000; stroke-width: 2.0;" width="642" x="620" y="2173.3906"/><rect fill="#FFFFFF" filter="url(#f1ddi6eat7xrzm)" height="244.1738" style="stroke: #000000; stroke-width: 2.0;" width="615" x="620" y="2462.1855"/><rect fill="#FFFFFF" filter="url(#f1ddi6eat7xrzm)" height="232.4844" style="stroke: #000000; stroke-width: 2.0;" width="594" x="620" y="2720.3594"/><rect fill="#FFFFFF" filter="url(#f1ddi6eat7xrzm)" height="348.9688" style="stroke: #000000; stroke-width: 2.0;" width="550" x="23" y="3003.1543"/><rect fill="#FFFFFF" height="201.7949" style="stroke: none; stroke-width: 1.0;" width="550" x="23" y="3150.3281"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="202" x2="202" y1="137.2871" y2="3376.123"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="421.5" x2="421.5" y1="137.2871" y2="3376.123"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="687" x2="687" y1="137.2871" y2="3376.123"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1051" x2="1051" y1="137.2871" y2="3376.123"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="98" x="150" y="134.334">Hub Employee</text><ellipse cx="202" cy="63.7988" fill="#FEFECE" filter="url(#f1ddi6eat7xrzm)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M202,71.7988 L202,98.7988 M189,79.7988 L215,79.7988 M202,98.7988 L189,113.7988 M202,98.7988 L215,113.7988 " fill="none" filter="url(#f1ddi6eat7xrzm)" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="98" x="150" y="3388.6582">Hub Employee</text><ellipse cx="202" cy="3401.6113" fill="#FEFECE" filter="url(#f1ddi6eat7xrzm)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M202,3409.6113 L202,3436.6113 M189,3417.6113 L215,3417.6113 M202,3436.6113 L189,3451.6113 M202,3436.6113 L215,3451.6113 " fill="none" filter="url(#f1ddi6eat7xrzm)" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="151" x="343.5" y="134.334">Settlement Service API</text><path d="M401.5,92.7988 L401.5,116.7988 M401.5,104.7988 L418.5,104.7988 " fill="none" filter="url(#f1ddi6eat7xrzm)" style="stroke: #A80036; stroke-width: 2.0;"/><ellipse cx="430.5" cy="104.7988" fill="#FEFECE" filter="url(#f1ddi6eat7xrzm)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="151" x="343.5" y="3388.6582">Settlement Service API</text><path d="M401.5,3395.6113 L401.5,3419.6113 M401.5,3407.6113 L418.5,3407.6113 " fill="none" filter="url(#f1ddi6eat7xrzm)" style="stroke: #A80036; stroke-width: 2.0;"/><ellipse cx="430.5" cy="3407.6113" fill="#FEFECE" filter="url(#f1ddi6eat7xrzm)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="108" x="630" y="134.334">Settlement DAO</text><ellipse cx="687" cy="104.7988" fill="#FEFECE" filter="url(#f1ddi6eat7xrzm)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="675" x2="699" y1="118.7988" y2="118.7988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="108" x="630" y="3388.6582">Settlement DAO</text><ellipse cx="687" cy="3407.6113" fill="#FEFECE" filter="url(#f1ddi6eat7xrzm)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="675" x2="699" y1="3421.6113" y2="3421.6113"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="90" x="1003" y="134.334">Central Store</text><path d="M1033,84.7988 C1033,74.7988 1051,74.7988 1051,74.7988 C1051,74.7988 1069,74.7988 1069,84.7988 L1069,110.7988 C1069,120.7988 1051,120.7988 1051,120.7988 C1051,120.7988 1033,120.7988 1033,110.7988 L1033,84.7988 " fill="#FEFECE" filter="url(#f1ddi6eat7xrzm)" style="stroke: #000000; stroke-width: 1.5;"/><path d="M1033,84.7988 C1033,94.7988 1051,94.7988 1051,94.7988 C1051,94.7988 1069,94.7988 1069,84.7988 " fill="none" style="stroke: #000000; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="90" x="1003" y="3388.6582">Central Store</text><path d="M1033,3401.6113 C1033,3391.6113 1051,3391.6113 1051,3391.6113 C1051,3391.6113 1069,3391.6113 1069,3401.6113 L1069,3427.6113 C1069,3437.6113 1051,3437.6113 1051,3437.6113 C1051,3437.6113 1033,3437.6113 1033,3427.6113 L1033,3401.6113 " fill="#FEFECE" filter="url(#f1ddi6eat7xrzm)" style="stroke: #000000; stroke-width: 1.5;"/><path d="M1033,3401.6113 C1033,3411.6113 1051,3411.6113 1051,3411.6113 C1051,3411.6113 1069,3411.6113 1069,3401.6113 " fill="none" style="stroke: #000000; stroke-width: 1.5;"/><rect fill="#FFFFFF" filter="url(#f1ddi6eat7xrzm)" height="3218.8359" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="197" y="147.2871"/><rect fill="#FFFFFF" filter="url(#f1ddi6eat7xrzm)" height="3065.9727" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="417" y="278.1504"/><rect fill="#FFFFFF" filter="url(#f1ddi6eat7xrzm)" height="2665.3828" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="682" y="322.7715"/><rect fill="#FFFFFF" filter="url(#f1ddi6eat7xrzm)" height="139.1738" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1046" y="352.082"/><rect fill="#FFFFFF" filter="url(#f1ddi6eat7xrzm)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1046" y="755.1816"/><rect fill="#FFFFFF" filter="url(#f1ddi6eat7xrzm)" height="154.4844" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1046" y="1000.9316"/><rect fill="#FFFFFF" filter="url(#f1ddi6eat7xrzm)" height="231.0371" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1046" y="1363.2109"/><rect fill="#FFFFFF" filter="url(#f1ddi6eat7xrzm)" height="185.1055" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1046" y="1623.5586"/><rect fill="#FFFFFF" filter="url(#f1ddi6eat7xrzm)" height="62.6211" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1046" y="1862.2852"/><rect fill="#FFFFFF" filter="url(#f1ddi6eat7xrzm)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1046" y="1996.5273"/><rect fill="#FFFFFF" filter="url(#f1ddi6eat7xrzm)" height="77.9316" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1046" y="2227.3223"/><rect fill="#FFFFFF" filter="url(#f1ddi6eat7xrzm)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1046" y="2376.875"/><rect fill="#FFFFFF" filter="url(#f1ddi6eat7xrzm)" height="62.6211" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1046" y="2500.8066"/><rect fill="#FFFFFF" filter="url(#f1ddi6eat7xrzm)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1046" y="2635.0488"/><rect fill="#FFFFFF" filter="url(#f1ddi6eat7xrzm)" height="93.2422" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1046" y="2758.9805"/><rect fill="#FFFFFF" filter="url(#f1ddi6eat7xrzm)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1046" y="2881.5332"/><path d="M13,154.2871 L172,154.2871 L172,161.2871 L162,171.2871 L13,171.2871 L13,154.2871 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="3204.8359" style="stroke: #000000; stroke-width: 2.0;" width="1331" x="13" y="154.2871"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="114" x="28" y="167.8555">Settlement Abort</text><path d="M212,176.5977 L212,247.5977 L432,247.5977 L432,186.5977 L422,176.5977 L212,176.5977 " fill="#FFFF00" filter="url(#f1ddi6eat7xrzm)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M422,176.5977 L422,186.5977 L432,186.5977 L422,176.5977 " fill="#FFFF00" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="218" y="194.166">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="122" x="234" y="209.4766">"state": "ABORTED",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="183" x="234" y="224.7871">"reason": {abortReasonString}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="218" y="240.0977">}</text><polygon fill="#A80036" points="405,274.1504,415,278.1504,405,282.1504,409,278.1504" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="207" x2="411" y1="278.1504" y2="278.1504"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="214" y="273.4082">1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="141" x="227" y="273.4082">PUT - /settlement/{id}</text><polygon fill="#A80036" points="670,318.7715,680,322.7715,670,326.7715,674,322.7715" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="427" x2="676" y1="322.7715" y2="322.7715"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="434" y="310.374">2</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="223" x="447" y="302.7188">abortSettlementById facade method</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="73" x="447" y="318.0293">Error code:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="524" y="318.0293">2001</text><polygon fill="#A80036" points="1034,348.082,1044,352.082,1034,356.082,1038,352.082" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="692" x2="1040" y1="352.082" y2="352.082"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="699" y="347.3398">3</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="199" x="712" y="347.3398">Retrieve settlement information</text><polygon fill="#FFFFE0" filter="url(#f1ddi6eat7xrzm)" points="864,365.082,1238,365.082,1248,414.082,1238,464.082,864,464.082,854,414.082,864,365.082" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="286" x="866" y="381.6504">SELECT s.settlementId, ssc.settlementStateId,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="175" x="882" y="396.9609">ssc.reason, ssc.createdDate</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="36" x="866" y="412.2715">FROM</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="72" x="906" y="412.2715">settlement</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="7" x="982" y="412.2715">s</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="28" x="866" y="427.582">JOIN</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="157" x="898" y="427.582">settlementStateChange</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="21" x="1059" y="427.582">ssc</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="370" x="866" y="442.8926">ON ssc.settlementStateChangeId = s.currentStateChangeId</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="175" x="866" y="458.2031">WHERE s.settlementId = {id}</text><polygon fill="#A80036" points="703,487.2559,693,491.2559,703,495.2559,699,491.2559" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="697" x2="1050" y1="491.2559" y2="491.2559"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="709" y="486.5137">4</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="41" x="722" y="486.5137">Return</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="103" x="767" y="486.5137">settlementData</text><path d="M610,506.2559 L672,506.2559 L672,513.2559 L662,523.2559 L610,523.2559 L610,506.2559 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="804.334" style="stroke: #000000; stroke-width: 2.0;" width="724" x="610" y="506.2559"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="17" x="625" y="519.8242">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="388" x="687" y="518.8906">[settlementData.settlementStateId == 'PS_TRANSFERS_COMMITTED'||</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="276" x="687" y="531.8457">settlementData.settlementStateId == 'SETTLING'||</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="268" x="687" y="544.8008">settlementData.settlementStateId == 'SETTLED']</text><path d="M687,554.4316 L771,554.4316 L771,561.4316 L761,571.4316 L687,571.4316 L687,554.4316 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="133.1738" style="stroke: #000000; stroke-width: 2.0;" width="380" x="687" y="554.4316"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="39" x="702" y="568">break</text><path d="M697,576.7422 L697,677.7422 L1053,677.7422 L1053,586.7422 L1043,576.7422 L697,576.7422 " fill="#FFFF00" filter="url(#f1ddi6eat7xrzm)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M1043,576.7422 L1043,586.7422 L1053,586.7422 L1043,576.7422 " fill="#FFFF00" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="703" y="594.3105">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="116" x="719" y="609.6211">errorInformation: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="148" x="735" y="624.9316">"errorCode": &lt;integer&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="303" x="735" y="640.2422">"errorDescription": "State change is not allowed"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="719" y="655.5527">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="703" y="670.8633">}</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="610" x2="1334" y1="695.6055" y2="695.6055"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="277" x="615" y="706.2402">[settlementData.settlementStateId == 'ABORTED']</text><path d="M620,716.5605 L704,716.5605 L704,723.5605 L694,733.5605 L620,733.5605 L620,716.5605 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="241.1055" style="stroke: #000000; stroke-width: 2.0;" width="594" x="620" y="716.5605"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="39" x="635" y="730.1289">break</text><polygon fill="#A80036" points="1034,751.1816,1044,755.1816,1034,759.1816,1038,755.1816" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="692" x2="1040" y1="755.1816" y2="755.1816"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="699" y="750.4395">5</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="264" x="712" y="750.4395">Append additional info at settlement level</text><polygon fill="#FFFFE0" filter="url(#f1ddi6eat7xrzm)" points="907,798.1816,1194,798.1816,1204,824.1816,1194,851.1816,907,851.1816,897,824.1816,907,798.1816" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="80" x="909" y="814.75">INSERT INTO</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="157" x="993" y="814.75">settlementStateChange</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="255" x="925" y="830.0605">(settlementId, settlementStateId, reason)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="283" x="909" y="845.3711">VALUES ({id}, 'ABORTED', {abortReasonString})</text><path d="M697,862.1133 L697,948.1133 L917,948.1133 L917,872.1133 L907,862.1133 L697,862.1133 " fill="#FFFF00" filter="url(#f1ddi6eat7xrzm)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M907,862.1133 L907,872.1133 L917,872.1133 L907,862.1133 " fill="#FFFF00" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="703" y="879.6816">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="54" x="719" y="894.9922">"id": {id},</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="118" x="719" y="910.3027">"state": 'ABORTED',</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="183" x="719" y="925.6133">"reason": {abortReasonString}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="703" y="940.9238">}</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="610" x2="1334" y1="965.666" y2="965.666"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="371" x="615" y="976.3008">[settlementData.settlementStateId == 'PS_TRANSFERS_RESERVED']</text><polygon fill="#A80036" points="1034,996.9316,1044,1000.9316,1034,1004.9316,1038,1000.9316" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="692" x2="1040" y1="1000.9316" y2="1000.9316"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="699" y="996.1895">6</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="278" x="712" y="996.1895">Find account in PS_TRANSFERS_COMMITTED</text><polygon fill="#FFFFE0" filter="url(#f1ddi6eat7xrzm)" points="787,1013.9316,1314,1013.9316,1324,1070.9316,1314,1128.9316,787,1128.9316,777,1070.9316,787,1013.9316" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="211" x="789" y="1030.5">SELECT spc.participantCurrencyId</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="36" x="789" y="1045.8105">FROM</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="207" x="829" y="1045.8105">settlementParticipantCurrency</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="22" x="1040" y="1045.8105">spc</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="28" x="789" y="1061.1211">JOIN</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="292" x="821" y="1061.1211">settlementParticipantCurrencyStateChange</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="36" x="1117" y="1061.1211">spcsc</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="523" x="789" y="1076.4316">ON spcsc.settlementParticipantCurrencyStateChangeId = spc.currentStateChangeId</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="190" x="789" y="1091.7422">WHERE spc.settlementId = {id}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="384" x="789" y="1107.0527">AND spcsc.settlementStateId = 'PS_TRANSFERS_COMMITTED'</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="46" x="789" y="1122.3633">LIMIT 1</text><polygon fill="#A80036" points="703,1151.416,693,1155.416,703,1159.416,699,1155.416" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="697" x2="1050" y1="1155.416" y2="1155.416"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="709" y="1150.6738">7</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="41" x="722" y="1150.6738">Return</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="183" x="767" y="1150.6738">transferCommittedAccount</text><path d="M687,1170.416 L771,1170.416 L771,1177.416 L761,1187.416 L687,1187.416 L687,1170.416 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="133.1738" style="stroke: #000000; stroke-width: 2.0;" width="494" x="687" y="1170.416"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="39" x="702" y="1183.9844">break</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="235" x="786" y="1183.0508">[transferCommittedAccount != undefined]</text><path d="M697,1192.7266 L697,1293.7266 L1167,1293.7266 L1167,1202.7266 L1157,1192.7266 L697,1192.7266 " fill="#FFFF00" filter="url(#f1ddi6eat7xrzm)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M1157,1192.7266 L1157,1202.7266 L1167,1202.7266 L1157,1192.7266 " fill="#FFFF00" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="703" y="1210.2949">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="116" x="719" y="1225.6055">errorInformation: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="148" x="735" y="1240.916">"errorCode": &lt;integer&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="417" x="735" y="1256.2266">"errorDescription": "At least one settlement transfer is committed"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="719" y="1271.5371">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="703" y="1286.8477">}</text><path d="M610,1324.5898 L775,1324.5898 L775,1331.5898 L765,1341.5898 L610,1341.5898 L610,1324.5898 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="1635.2539" style="stroke: #000000; stroke-width: 2.0;" width="682" x="610" y="1324.5898"/><text fill="#0000FF" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="120" x="625" y="1338.1582">DB TRANSACTION</text><polygon fill="#A80036" points="1034,1359.2109,1044,1363.2109,1034,1367.2109,1038,1363.2109" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="692" x2="1040" y1="1363.2109" y2="1363.2109"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="699" y="1358.4688">8</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="253" x="712" y="1358.4688">Retrive settlement accounts information</text><polygon fill="#FFFFE0" filter="url(#f1ddi6eat7xrzm)" points="867,1376.2109,1235,1376.2109,1245,1471.2109,1235,1567.2109,867,1567.2109,857,1471.2109,867,1376.2109" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="322" x="869" y="1392.7793">SELECT pc.participantId, spc.participantCurrencyId,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="244" x="885" y="1408.0898">spcsc.settlementStateId, spcsc.reason,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="316" x="885" y="1423.4004">spcsc.createdDate, spc.netAmount, pc.currencyId,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="248" x="885" y="1438.7109">spc.settlementParticipantCurrencyId AS</text><text fill="#0000FF" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="22" x="1137" y="1438.7109">key</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="36" x="869" y="1454.0215">FROM</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="207" x="909" y="1454.0215">settlementParticipantCurrency</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="22" x="1120" y="1454.0215">spc</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="28" x="869" y="1469.332">JOIN</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="292" x="901" y="1469.332">settlementParticipantCurrencyStateChange</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="36" x="1197" y="1469.332">spcsc</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="358" x="869" y="1484.6426">ON spcsc.settlementParticipantCurrencyStateChangeId =</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="161" x="869" y="1499.9531">spc.currentStateChangeId</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="28" x="869" y="1515.2637">JOIN</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="136" x="901" y="1515.2637">participantCurrency</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="15" x="1041" y="1515.2637">pc</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="359" x="869" y="1530.5742">ON pc.participantCurrencyId = spc.participantCurrencyId</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="190" x="869" y="1545.8848">WHERE spc.settlementId = {id}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="79" x="869" y="1561.1953">FOR UPDATE</text><polygon fill="#A80036" points="703,1590.248,693,1594.248,703,1598.248,699,1594.248" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="697" x2="1050" y1="1594.248" y2="1594.248"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="709" y="1589.5059">9</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="41" x="722" y="1589.5059">Return</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="158" x="767" y="1589.5059">settlementAccountsList</text><polygon fill="#A80036" points="1034,1619.5586,1044,1623.5586,1034,1627.5586,1038,1623.5586" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="692" x2="1040" y1="1623.5586" y2="1623.5586"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="699" y="1618.8164">10</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="251" x="721" y="1618.8164">Retrive settlement windows information</text><polygon fill="#FFFFE0" filter="url(#f1ddi6eat7xrzm)" points="829,1636.5586,1272,1636.5586,1282,1708.5586,1272,1781.5586,829,1781.5586,819,1708.5586,829,1636.5586" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="411" x="831" y="1653.127">SELECT ssw.settlementWindowId, swsc.settlementWindowStateId,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="195" x="847" y="1668.4375">swsc.reason, swsc.createdDate</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="36" x="831" y="1683.748">FROM</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="197" x="871" y="1683.748">settlementSettlementWindow</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="24" x="1072" y="1683.748">ssw</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="28" x="831" y="1699.0586">JOIN</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="125" x="863" y="1699.0586">settlementWindow</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="17" x="992" y="1699.0586">sw</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="335" x="831" y="1714.3691">ON sw.settlementWindow = ssw.settlementWindowId</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="28" x="831" y="1729.6797">JOIN</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="210" x="863" y="1729.6797">settlementWindowStateChange</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="31" x="1077" y="1729.6797">swsc</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="439" x="831" y="1744.9902">ON swsc.settlementWindowStateChangeId = sw.currentStateChangeId</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="192" x="831" y="1760.3008">WHERE ssw.settlementId = {id}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="79" x="831" y="1775.6113">FOR UPDATE</text><polygon fill="#A80036" points="703,1804.6641,693,1808.6641,703,1812.6641,699,1808.6641" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="697" x2="1050" y1="1808.6641" y2="1808.6641"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="709" y="1803.9219">11</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="41" x="731" y="1803.9219">Return</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="83" x="776" y="1803.9219">windowsList</text><path d="M620,1823.6641 L1033,1823.6641 L1033,1830.6641 L1023,1840.6641 L620,1840.6641 L620,1823.6641 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="244.1738" style="stroke: #000000; stroke-width: 2.0;" width="656" x="620" y="1823.6641"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="368" x="635" y="1837.2324">Bulk insert settlementParticipantCurrencyStateChange</text><polygon fill="#A80036" points="1034,1858.2852,1044,1862.2852,1034,1866.2852,1038,1862.2852" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="692" x2="1040" y1="1862.2852" y2="1862.2852"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="699" y="1857.543">12</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="308" x="721" y="1857.543">Insert settlementParticipantCurrencyStateChange</text><polygon fill="#FFFFE0" filter="url(#f1ddi6eat7xrzm)" points="915,1875.2852,1187,1875.2852,1197,1886.2852,1187,1898.2852,915,1898.2852,905,1886.2852,915,1875.2852" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="268" x="917" y="1891.8535">settlementParticipantCurrencyStateChange</text><polygon fill="#A80036" points="703,1920.9063,693,1924.9063,703,1928.9063,699,1924.9063" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="697" x2="1050" y1="1924.9063" y2="1924.9063"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="709" y="1920.1641">13</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="41" x="731" y="1920.1641">Return</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="74" x="776" y="1920.1641">spcscIdList</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="692" x2="734" y1="1954.2168" y2="1954.2168"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="734" x2="734" y1="1954.2168" y2="1967.2168"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="693" x2="734" y1="1967.2168" y2="1967.2168"/><polygon fill="#A80036" points="703,1963.2168,693,1967.2168,703,1971.2168,699,1967.2168" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="699" y="1949.4746">14</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="295" x="721" y="1949.4746">Merge spcscIdList into settlementAccountsList</text><polygon fill="#A80036" points="1034,1992.5273,1044,1996.5273,1034,2000.5273,1038,1996.5273" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="692" x2="1040" y1="1996.5273" y2="1996.5273"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="699" y="1991.7852">15</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="292" x="721" y="1991.7852">Update all pointers to current state change ids</text><polygon fill="#FFFFE0" filter="url(#f1ddi6eat7xrzm)" points="845,2039.5273,1256,2039.5273,1266,2050.5273,1256,2062.5273,845,2062.5273,835,2050.5273,845,2039.5273" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="50" x="847" y="2056.0957">UPDATE</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="207" x="901" y="2056.0957">settlementParticipantCurrency</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="146" x="1108" y="2056.0957">.currentStateChangeIds</text><rect fill="#FFFFFF" filter="url(#f1ddi6eat7xrzm)" height="86.5527" style="stroke: #000000; stroke-width: 2.0;" width="471" x="627" y="2074.8379"/><polygon fill="#EEEEEE" points="627,2074.8379,691,2074.8379,691,2081.8379,681,2091.8379,627,2091.8379,627,2074.8379" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="19" x="640" y="2089.4063">ref</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="162" x="687" y="2108.4063">Settlement Transfer Abort</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="691" y="2123.7168"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="43" x="687" y="2139.0273">Inputs</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="312" x="730" y="2139.0273">: settlementId, transactionTimestamp, enums, trx</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="691" y="2154.3379"/><path d="M620,2173.3906 L1038,2173.3906 L1038,2195.3906 L1028,2205.3906 L620,2205.3906 L620,2173.3906 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="274.7949" style="stroke: #000000; stroke-width: 2.0;" width="642" x="620" y="2173.3906"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="369" x="635" y="2186.959">Bulk insert settlementWindowContentStateChange and</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="317" x="639" y="2202.2695">update settlementContentAggregation records</text><polygon fill="#A80036" points="1034,2223.3223,1044,2227.3223,1034,2231.3223,1038,2227.3223" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="692" x2="1040" y1="2227.3223" y2="2227.3223"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="699" y="2222.5801">16</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="228" x="721" y="2222.5801">Insert swcsc and update sca records</text><polygon fill="#FFFFE0" filter="url(#f1ddi6eat7xrzm)" points="927,2240.3223,1175,2240.3223,1185,2259.3223,1175,2278.3223,927,2278.3223,917,2259.3223,927,2240.3223" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="244" x="929" y="2256.8906">settlementWindowContentStateChange</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="194" x="929" y="2272.2012">settlementContentAggregation</text><polygon fill="#A80036" points="703,2301.2539,693,2305.2539,703,2309.2539,699,2305.2539" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="697" x2="1050" y1="2305.2539" y2="2305.2539"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="709" y="2300.5117">17</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="41" x="731" y="2300.5117">Return</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="76" x="776" y="2300.5117">swcscIdList</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="692" x2="734" y1="2334.5645" y2="2334.5645"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="734" x2="734" y1="2334.5645" y2="2347.5645"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="693" x2="734" y1="2347.5645" y2="2347.5645"/><polygon fill="#A80036" points="703,2343.5645,693,2347.5645,703,2351.5645,699,2347.5645" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="699" y="2329.8223">18</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="115" x="721" y="2329.8223">Merge swcscIdList</text><polygon fill="#A80036" points="1034,2372.875,1044,2376.875,1034,2380.875,1038,2376.875" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="692" x2="1040" y1="2376.875" y2="2376.875"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="699" y="2372.1328">19</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="292" x="721" y="2372.1328">Update all pointers to current state change ids</text><polygon fill="#FFFFE0" filter="url(#f1ddi6eat7xrzm)" points="860,2419.875,1242,2419.875,1252,2430.875,1242,2442.875,860,2442.875,850,2430.875,860,2419.875" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="50" x="862" y="2436.4434">UPDATE</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="178" x="916" y="2436.4434">settlementWindowContent</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="146" x="1094" y="2436.4434">.currentStateChangeIds</text><path d="M620,2462.1855 L951,2462.1855 L951,2469.1855 L941,2479.1855 L620,2479.1855 L620,2462.1855 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="244.1738" style="stroke: #000000; stroke-width: 2.0;" width="615" x="620" y="2462.1855"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="286" x="635" y="2475.7539">Bulk insert settlementWindowStateChange</text><polygon fill="#A80036" points="1034,2496.8066,1044,2500.8066,1034,2504.8066,1038,2500.8066" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="692" x2="1040" y1="2500.8066" y2="2500.8066"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="699" y="2496.0645">20</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="234" x="721" y="2496.0645">Insert settlementWindowStateChange</text><polygon fill="#FFFFE0" filter="url(#f1ddi6eat7xrzm)" points="952,2513.8066,1150,2513.8066,1160,2524.8066,1150,2536.8066,952,2536.8066,942,2524.8066,952,2513.8066" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="194" x="954" y="2530.375">settlementWindowStateChange</text><polygon fill="#A80036" points="703,2559.4277,693,2563.4277,703,2567.4277,699,2563.4277" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="697" x2="1050" y1="2563.4277" y2="2563.4277"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="709" y="2558.6855">21</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="41" x="731" y="2558.6855">Return</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="69" x="776" y="2558.6855">swscIdList</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="692" x2="734" y1="2592.7383" y2="2592.7383"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="734" x2="734" y1="2592.7383" y2="2605.7383"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="693" x2="734" y1="2605.7383" y2="2605.7383"/><polygon fill="#A80036" points="703,2601.7383,693,2605.7383,703,2609.7383,699,2605.7383" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="699" y="2587.9961">22</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="212" x="721" y="2587.9961">Merge swscIdList into windowList</text><polygon fill="#A80036" points="1034,2631.0488,1044,2635.0488,1034,2639.0488,1038,2635.0488" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="692" x2="1040" y1="2635.0488" y2="2635.0488"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="699" y="2630.3066">23</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="292" x="721" y="2630.3066">Update all pointers to current state change ids</text><polygon fill="#FFFFE0" filter="url(#f1ddi6eat7xrzm)" points="886,2678.0488,1215,2678.0488,1225,2689.0488,1215,2701.0488,886,2701.0488,876,2689.0488,886,2678.0488" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="50" x="888" y="2694.6172">UPDATE</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="125" x="942" y="2694.6172">settlementWindow</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="146" x="1067" y="2694.6172">.currentStateChangeIds</text><path d="M620,2720.3594 L865,2720.3594 L865,2727.3594 L855,2737.3594 L620,2737.3594 L620,2720.3594 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="232.4844" style="stroke: #000000; stroke-width: 2.0;" width="594" x="620" y="2720.3594"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="200" x="635" y="2733.9277">Insert settlementStateChange</text><polygon fill="#A80036" points="1034,2754.9805,1044,2758.9805,1034,2762.9805,1038,2758.9805" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="692" x2="1040" y1="2758.9805" y2="2758.9805"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="699" y="2754.2383">24</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="185" x="721" y="2754.2383">Insert settlementStateChange</text><polygon fill="#FFFFE0" filter="url(#f1ddi6eat7xrzm)" points="907,2771.9805,1194,2771.9805,1204,2797.9805,1194,2824.9805,907,2824.9805,897,2797.9805,907,2771.9805" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="80" x="909" y="2788.5488">INSERT INTO</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="157" x="993" y="2788.5488">settlementStateChange</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="255" x="925" y="2803.8594">(settlementId, settlementStateId, reason)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="283" x="909" y="2819.1699">VALUES ({id}, 'ABORTED', {abortReasonString})</text><polygon fill="#A80036" points="703,2848.2227,693,2852.2227,703,2856.2227,699,2852.2227" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="697" x2="1050" y1="2852.2227" y2="2852.2227"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="709" y="2847.4805">25</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="41" x="731" y="2847.4805">Return</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="170" x="776" y="2847.4805">settlementStateChangeId</text><polygon fill="#A80036" points="1034,2877.5332,1044,2881.5332,1034,2885.5332,1038,2881.5332" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="692" x2="1040" y1="2881.5332" y2="2881.5332"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="699" y="2876.791">26</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="259" x="721" y="2876.791">Update pointer to current state change id</text><polygon fill="#FFFFE0" filter="url(#f1ddi6eat7xrzm)" points="916,2924.5332,1185,2924.5332,1195,2935.5332,1185,2947.5332,916,2947.5332,906,2935.5332,916,2924.5332" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="50" x="918" y="2941.1016">UPDATE</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="72" x="972" y="2941.1016">settlement</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="139" x="1044" y="2941.1016">.currentStateChangeId</text><polygon fill="#A80036" points="438,2984.1543,428,2988.1543,438,2992.1543,434,2988.1543" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="432" x2="686" y1="2988.1543" y2="2988.1543"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="444" y="2983.4121">27</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="178" x="466" y="2983.4121">Return facade method result</text><path d="M23,3003.1543 L85,3003.1543 L85,3010.1543 L75,3020.1543 L23,3020.1543 L23,3003.1543 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="348.9688" style="stroke: #000000; stroke-width: 2.0;" width="550" x="23" y="3003.1543"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="17" x="38" y="3016.7227">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="51" x="100" y="3015.7891">[success]</text><path d="M188,3025.4648 L188,3111.4648 L408,3111.4648 L408,3035.4648 L398,3025.4648 L188,3025.4648 " fill="#FFFF00" filter="url(#f1ddi6eat7xrzm)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M398,3025.4648 L398,3035.4648 L408,3035.4648 L398,3025.4648 " fill="#FFFF00" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="194" y="3043.0332">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="54" x="210" y="3058.3438">"id": {id},</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="118" x="210" y="3073.6543">"state": 'ABORTED',</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="183" x="210" y="3088.9648">"reason": {abortReasonString}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="194" y="3104.2754">}</text><polygon fill="#A80036" points="218,3138.3281,208,3142.3281,218,3146.3281,214,3142.3281" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="212" x2="416" y1="3142.3281" y2="3142.3281"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="224" y="3137.5859">28</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="161" x="246" y="3137.5859">Respond HTTP - 200 (OK)</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="23" x2="573" y1="3151.3281" y2="3151.3281"/><path d="M432,3157.3281 L432,3182.3281 L559,3182.3281 L559,3167.3281 L549,3157.3281 L432,3157.3281 " fill="#D3D3D3" filter="url(#f1ddi6eat7xrzm)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M549,3157.3281 L549,3167.3281 L559,3167.3281 L549,3157.3281 " fill="#D3D3D3" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="106" x="438" y="3174.8965">Log ERROR event</text><path d="M33,3196.6387 L33,3297.6387 L408,3297.6387 L408,3206.6387 L398,3196.6387 L33,3196.6387 " fill="#FFFF00" filter="url(#f1ddi6eat7xrzm)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M398,3196.6387 L398,3206.6387 L408,3206.6387 L398,3196.6387 " fill="#FFFF00" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="39" y="3214.207">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="116" x="55" y="3229.5176">errorInformation: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="148" x="71" y="3244.8281">"errorCode": &lt;integer&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="322" x="71" y="3260.1387">"errorDescription": "Client/Server error description"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="55" y="3275.4492">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="39" y="3290.7598">}</text><polygon fill="#A80036" points="218,3340.123,208,3344.123,218,3348.123,214,3344.123" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="212" x2="421" y1="3344.123" y2="3344.123"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="224" y="3331.7256">29</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="164" x="246" y="3324.0703">Respond HTTP 4xx or 5xx</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="124" x="246" y="3339.3809">(Client/Server error)</text><!--
@startuml
title 6.2.6. Settlement Abort (abortSettlementById)
autonumber

actor "Hub Employee" as OPERATOR
boundary "Settlement Service API" as SSAPI
entity "Settlement DAO" as SETTLE_DAO
database "Central Store" as DB

box "Central HUB" #lightpink
    participant OPERATOR
end box

box "Settlement Service" #lightgreen
    participant SSAPI
    participant SETTLE_DAO
end box

box "Central Services" #lightyellow
    participant DB
end box

group Settlement Abort
    activate OPERATOR
    note right of OPERATOR #yellow
        {
            "state": "ABORTED",
            "reason": {abortReasonString}
        }
    end note

    OPERATOR -> SSAPI: PUT - /settlement/{id}
    activate SSAPI
    SSAPI -> SETTLE_DAO: abortSettlementById facade method\n<color #FF0000><b>Error code:</b> 2001</color>
    activate SETTLE_DAO

    SETTLE_DAO -> DB: Retrieve settlement information
    activate DB
    hnote over DB #lightyellow
        SELECT s.settlementId, ssc.settlementStateId,
            ssc.reason, ssc.createdDate
        FROM **settlement** s
        JOIN **settlementStateChange** ssc
        ON ssc.settlementStateChangeId = s.currentStateChangeId
        WHERE s.settlementId = {id}
    end hnote
    SETTLE_DAO <- - DB: Return **settlementData**
    deactivate DB

    alt settlementData.settlementStateId == 'PS_TRANSFERS_COMMITTED'||\nsettlementData.settlementStateId == 'SETTLING'||\nsettlementData.settlementStateId == 'SETTLED'
    break
        note right of SETTLE_DAO #yellow
            {
                errorInformation: {
                    "errorCode": <integer>,
                    "errorDescription": "State change is not allowed"
                }
            }
        end note
    end
    else settlementData.settlementStateId == 'ABORTED'
    break
        SETTLE_DAO -> DB: Append additional info at settlement level
        activate DB
        deactivate DB
        hnote over DB #lightyellow
            INSERT INTO **settlementStateChange**
                (settlementId, settlementStateId, reason)
            VALUES ({id}, 'ABORTED', {abortReasonString})
        end hnote

        note right of SETTLE_DAO #yellow
            {
                "id": {id},
                "state": 'ABORTED',
                "reason": {abortReasonString}
            }
        end note
    end
    else settlementData.settlementStateId == 'PS_TRANSFERS_RESERVED'
        SETTLE_DAO -> DB: Find account in PS_TRANSFERS_COMMITTED
        activate DB
        hnote over DB #lightyellow
            SELECT spc.participantCurrencyId
            FROM **settlementParticipantCurrency** spc
            JOIN **settlementParticipantCurrencyStateChange** spcsc
            ON spcsc.settlementParticipantCurrencyStateChangeId = spc.currentStateChangeId
            WHERE spc.settlementId = {id}
            AND spcsc.settlementStateId = 'PS_TRANSFERS_COMMITTED'
            LIMIT 1
        end hnote
        SETTLE_DAO <- - DB: Return **transferCommittedAccount**
        deactivate DB
        break transferCommittedAccount != undefined
            note right of SETTLE_DAO #yellow
                {
                    errorInformation: {
                        "errorCode": <integer>,
                        "errorDescription": "At least one settlement transfer is committed"
                    }
                }
            end note
        end
    end

    group <color #blue>DB TRANSACTION</color>
        SETTLE_DAO -> DB: Retrive settlement accounts information
        activate DB
        hnote over DB #lightyellow
            SELECT pc.participantId, spc.participantCurrencyId,
                spcsc.settlementStateId, spcsc.reason,
                spcsc.createdDate, spc.netAmount, pc.currencyId,
                spc.settlementParticipantCurrencyId AS <color #0000FF>key</color>
            FROM **settlementParticipantCurrency** spc
            JOIN **settlementParticipantCurrencyStateChange** spcsc
            ON spcsc.settlementParticipantCurrencyStateChangeId =
            spc.currentStateChangeId
            JOIN **participantCurrency** pc
            ON pc.participantCurrencyId = spc.participantCurrencyId
            WHERE spc.settlementId = {id}
            FOR UPDATE
        end hnote
        SETTLE_DAO <- - DB: Return **settlementAccountsList**
        deactivate DB

        SETTLE_DAO -> DB: Retrive settlement windows information
        activate DB
        hnote over DB #lightyellow
            SELECT ssw.settlementWindowId, swsc.settlementWindowStateId,
                swsc.reason, swsc.createdDate
            FROM **settlementSettlementWindow** ssw
            JOIN **settlementWindow** sw
            ON sw.settlementWindow = ssw.settlementWindowId
            JOIN **settlementWindowStateChange** swsc
            ON swsc.settlementWindowStateChangeId = sw.currentStateChangeId
            WHERE ssw.settlementId = {id}
            FOR UPDATE
        end hnote
        SETTLE_DAO <- - DB: Return **windowsList**
        deactivate DB

        group Bulk insert settlementParticipantCurrencyStateChange
            SETTLE_DAO -> DB: Insert settlementParticipantCurrencyStateChange
            activate DB
            hnote over DB #lightyellow
                settlementParticipantCurrencyStateChange
            end hnote
            SETTLE_DAO <- - DB: Return **spcscIdList**
            deactivate DB

            SETTLE_DAO -> SETTLE_DAO: Merge spcscIdList into settlementAccountsList

            SETTLE_DAO -> DB: Update all pointers to current state change ids
            activate DB
            hnote over DB #lightyellow
                UPDATE **settlementParticipantCurrency**.currentStateChangeIds
            end hnote
            deactivate DB
        end

        ref over SETTLE_DAO, DB: Settlement Transfer Abort\n\n**Inputs**: settlementId, transactionTimestamp, enums, trx\n

        group Bulk insert settlementWindowContentStateChange and \n update settlementContentAggregation records
            SETTLE_DAO -> DB: Insert swcsc and update sca records
            activate DB
            hnote over DB #lightyellow
                settlementWindowContentStateChange
                settlementContentAggregation
            end hnote
            SETTLE_DAO <- - DB: Return **swcscIdList**
            deactivate DB

            SETTLE_DAO -> SETTLE_DAO: Merge swcscIdList

            SETTLE_DAO -> DB: Update all pointers to current state change ids
            activate DB
            hnote over DB #lightyellow
                UPDATE **settlementWindowContent**.currentStateChangeIds
            end hnote
            deactivate DB
        end

        group Bulk insert settlementWindowStateChange
            SETTLE_DAO -> DB: Insert settlementWindowStateChange
            activate DB
            hnote over DB #lightyellow
                settlementWindowStateChange
            end hnote
            SETTLE_DAO <- - DB: Return **swscIdList**
            deactivate DB

            SETTLE_DAO -> SETTLE_DAO: Merge swscIdList into windowList

            SETTLE_DAO -> DB: Update all pointers to current state change ids
            activate DB
            hnote over DB #lightyellow
                UPDATE **settlementWindow**.currentStateChangeIds
            end hnote
            deactivate DB
        end

        group Insert settlementStateChange
            SETTLE_DAO -> DB: Insert settlementStateChange
            activate DB
            hnote over DB #lightyellow
                INSERT INTO **settlementStateChange**
                    (settlementId, settlementStateId, reason)
                VALUES ({id}, 'ABORTED', {abortReasonString})
            end hnote
            SETTLE_DAO <- - DB: Return **settlementStateChangeId**
            deactivate DB

            SETTLE_DAO -> DB: Update pointer to current state change id
            activate DB
            hnote over DB #lightyellow
                UPDATE **settlement**.currentStateChangeId
            end hnote
            deactivate DB
        end
    end
    SSAPI <- - SETTLE_DAO: Return facade method result
    deactivate SETTLE_DAO

    alt success
        note left of SSAPI #yellow
            {
                "id": {id},
                "state": 'ABORTED',
                "reason": {abortReasonString}
            }
        end note

        SSAPI - -> OPERATOR: Respond HTTP - 200 (OK)
      else
        note right of SSAPI #lightgray
            Log ERROR event
        end note
        note left of SSAPI #yellow
            {
                errorInformation: {
                    "errorCode": <integer>,
                    "errorDescription": "Client/Server error description"
                }
            }
        end note
        OPERATOR <- - SSAPI: Respond HTTP 4xx or 5xx\n(Client/Server error)
        deactivate SSAPI
    end
end
deactivate OPERATOR
@enduml

PlantUML version 1.2018.05(Sat May 05 23:00:17 EEST 2018)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Java Version: 1.8.0_131-b11
Operating System: Mac OS X
OS Version: 10.15.1
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>